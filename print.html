<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Blueprinter</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="theme/hljs-overrides.css">


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Blueprinter</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/procore-oss/blueprinter" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="blueprinter"><a class="header" href="#blueprinter">Blueprinter</a></h1>
<p>Blueprinter is a JSON Object Presenter for Ruby that takes business objects and breaks them down into simple hashes and serializes them to JSON. It can be used in Rails in place of other serializers (like JBuilder or ActiveModelSerializers). It is designed to be simple, direct, and performant.</p>
<h3 id="installation"><a class="header" href="#installation">Installation</a></h3>
<pre><code class="language-bash">bundle add blueprinter
</code></pre>
<h3 id="api-docs"><a class="header" href="#api-docs">API Docs</a></h3>
<p>Generated code documentation can be found at <a href="https://www.rubydoc.info/gems/blueprinter">rubydoc.info/gems/blueprinter</a>.</p>
<h3 id="basic-usage"><a class="header" href="#basic-usage">Basic Usage</a></h3>
<pre><code class="language-ruby">class WidgetBlueprint &lt; ApplicationBlueprint
  field :name
  object :category, CategoryBlueprint
  collection :parts, PartBlueprint

  view :extended do
    field :description
    association :manufacturer, CompanyBlueprint
    association :vendors, [CompanyBlueprint]
  end
end

# Render the default view
data = WidgetBlueprint.render(widget)

# Render the extended view
data = WidgetBlueprint[:extended].render(widget)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="blueprinter-dsl"><a class="header" href="#blueprinter-dsl">Blueprinter DSL</a></h1>
<h2 id="define-your-base-class"><a class="header" href="#define-your-base-class">Define your base class</a></h2>
<p>Define an <code>ApplicationBlueprint</code> for your blueprints to inherit from. Define common fields, <a href="dsl/./views.html">views</a>, <a href="dsl/./partials.html">partials</a>, <a href="dsl/./formatters.html">formatters</a>, <a href="dsl/./extensions.html">extensions</a>, and <a href="dsl/./options.html">options</a>.</p>
<pre><code class="language-ruby">class ApplicationBlueprint &lt; Blueprinter::V2::Base
  field :id
end
</code></pre>
<h2 id="define-blueprints-for-your-models"><a class="header" href="#define-blueprints-for-your-models">Define blueprints for your models</a></h2>
<p>The following blueprint:</p>
<ul>
<li>Inherits <code>id</code> from <code>ApplicationBlueprint</code></li>
<li>Defines a <code>name</code> field</li>
<li>Defines a <code>category</code> association that will render using another blueprint</li>
<li>Defines a <code>parts</code> <strong>array</strong> association that will render using another blueprint</li>
</ul>
<pre><code class="language-ruby">class WidgetBlueprint &lt; ApplicationBlueprint
  field :name
  object :category, CategoryBlueprint
  collection :parts, PartBlueprint
end
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="views"><a class="header" href="#views">Views</a></h1>
<p>Blueprints can define views to provide different representations of the data. A view inherits everything from its parent, but may choose to override some pieces.</p>
<p>At the top level of every Blueprint is an implicit view called <code>default</code>. This view is used when no other view is specified.</p>
<pre><code class="language-ruby">class WidgetBlueprint &lt; ApplicationBlueprint
  field :name
  object :category, CategoryBlueprint

  # The "with_parts" view adds a collection of parts
  view :with_parts do
    collection :parts, PartBlueprint
  end

  # Views can include other views
  view :full do
    use :with_parts
    field :description
  end
end
</code></pre>
<h3 id="excluding-fields"><a class="header" href="#excluding-fields">Excluding fields</a></h3>
<p>Views can exclude fields from a parent:</p>
<pre><code class="language-ruby">class WidgetBlueprint &lt; ApplicationBlueprint
  fields :name, :description, :price

  view :simple do
    exclude :description, :price
  end
end
</code></pre>
<h3 id="nested-views"><a class="header" href="#nested-views">Nested views</a></h3>
<p>You can nest views within views, allowing for a hierarchy of inheritance.</p>
<pre><code class="language-ruby">class WidgetBlueprint &lt; ApplicationBlueprint
  field :name
  object :category, CategoryBlueprint
  collection :parts, PartBlueprint

  view :extended do
    field :description

    # The "extended.with_price" view adds a price field
    view :with_price do
      field :price
    end
  end

</code></pre>
<h3 id="referencing-views"><a class="header" href="#referencing-views">Referencing views</a></h3>
<p>When defining an object or collection, you can choose a view from the blueprint:</p>
<pre><code class="language-ruby">object :category, CategoryBlueprint[:extended]
collection :parts, PartBlueprint["extended.plus"]
</code></pre>
<h3 id="inheriting-from-views"><a class="header" href="#inheriting-from-views">Inheriting from views</a></h3>
<p>You can inherit from another blueprint's view:</p>
<pre><code class="language-ruby">class WidgetBlueprint &lt; ApplicationBlueprint[:financial]
  # ...
end
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="partials"><a class="header" href="#partials">Partials</a></h1>
<p>Partials allow you to compose views from reusable components.</p>
<pre><code class="language-ruby">class WidgetBlueprint &lt; ApplicationBlueprint
  field :name
  field :description

  view :foo do
    field :foo
    use :associations
  end

  view :bar do
    field :bar
    use :associations
  end

  partial :associations do
    object :category, CategoryBlueprint
    collection :parts, PartBlueprint
  end
end
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="formatters"><a class="header" href="#formatters">Formatters</a></h1>
<p>Automatically format field values by class.</p>
<pre><code class="language-ruby">class ApplicationBlueprint
  # Strip whitespace from all strings
  format(String) { |val| val.strip }

  # Format all dates and times using ISO-8601
  format Date, :iso8601
  format Time, :iso8601

  def iso8601(val)
    val.iso8601
  end
end
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="options"><a class="header" href="#options">Options</a></h1>
<p>Numerous options can be defined on Blueprints, views, partials, or individual fields. Some can also be passed to <code>render</code>.</p>
<pre><code class="language-ruby">class WidgetBlueprint &lt; ApplicationBlueprint
  # Blueprint options apply to all fields, objects, and collections in the Blueprint.
  # Options are inherited from the parent class and can be overridden.
  options[:exclude_if_empty] = true

  # Field options apply to individual fields, objects, and collections. They can
  # override Blueprint options.
  field :name, exclude_if_empty: false

  # Options in views apply to all fields, objects, and collections in the view. They
  # inherit options from the Blueprint, or from parent views, and can override them.
  view :foo do
    options[:exclude_if_empty] = false
  end

  # Options in partials apply to all fields, objects, and collections in the partial
  # AND in views that use the partial. They inherit options from the Blueprint, or
  # from parent views, and can override them.
  partial :bar do
    options[:exclude_if_empty] = false
  end
end
</code></pre>
<h2 id="default-values"><a class="header" href="#default-values">Default Values</a></h2>
<h4 id="default"><a class="header" href="#default">default</a></h4>
<p>A default value in case this field's value is nil.</p>
<p><em>Scope:</em> Field, object, collection</p>
<pre><code class="language-ruby">field :foo, default: "Foo"
field :foo, default: -&gt;(ctx) { "Foo" }
field :foo, default: :foo

def foo(ctx)
  "Foo"
end
</code></pre>
<h4 id="field_default"><a class="header" href="#field_default">field_default</a></h4>
<p>Default value for any <em>regular</em> field that's nil.</p>
<p><em>Scope:</em> Blueprint, view, partial, render</p>
<pre><code class="language-ruby">options[:field_default] = "Foo"
options[:field_default] = -&gt;(ctx) { "Foo" }
options[:field_default] = :foo

def foo(ctx)
  "Foo"
end
</code></pre>
<h4 id="object_default"><a class="header" href="#object_default">object_default</a></h4>
<p>Default value for any <em>object</em> field that's nil.</p>
<p><em>Scope:</em> Blueprint, view, partial, render</p>
<pre><code class="language-ruby">options[:object_default] = { name: "Foo" }
options[:object_default] = -&gt;(ctx) { { name: "Foo" } }
options[:object_default] = :foo

def foo(ctx)
  { name: "Foo" }
end
</code></pre>
<h4 id="collection_default"><a class="header" href="#collection_default">collection_default</a></h4>
<p>Default value for any <em>collection</em> field that's nil.</p>
<p><em>Scope:</em> Blueprint, view, partial, render</p>
<pre><code class="language-ruby">options[:collection_default] = [{ name: "Foo" }]
options[:collection_default] = -&gt;(ctx) { [{ name: "Foo" }] }
options[:collection_default] = :foo

def foo(ctx)
  [{ name: "Foo" }]
end
</code></pre>
<h4 id="default_if"><a class="header" href="#default_if">default_if</a></h4>
<p>Use the default value if the given Proc or method name returns truthy.</p>
<p><em>Scope:</em> Field, object, collection</p>
<pre><code class="language-ruby">field :foo, default: "Foo", default_if: -&gt;(ctx) { ctx.object.disabled? }
field :foo, default: "Foo", default_if: :disabled?

def disabled?(ctx)
  ctx.object.disabled?
end
</code></pre>
<h4 id="field_default_if"><a class="header" href="#field_default_if">field_default_if</a></h4>
<p>Same as <code>default_if</code>, but applies to any <em>regular</em> field in scope.</p>
<p><em>Scope:</em> Blueprint, view, partial, render</p>
<pre><code class="language-ruby">options[:field_default_if] = -&gt;(ctx) { ctx.object.disabled? }
options[:field_default_if] = :disabled?

def disabled?(ctx)
  ctx.object.disabled?
end
</code></pre>
<h4 id="object_default_if"><a class="header" href="#object_default_if">object_default_if</a></h4>
<p>Same as <code>default_if</code>, but applies to any <em>object</em> field in scope.</p>
<p><em>Scope:</em> Blueprint, view, partial, render</p>
<pre><code class="language-ruby">options[:object_default_if] = -&gt;(ctx) { ctx.object.disabled? }
options[:object_default_if] = :disabled?

def disabled?(ctx)
  ctx.object.disabled?
end
</code></pre>
<h4 id="collection_default_if"><a class="header" href="#collection_default_if">collection_default_if</a></h4>
<p>Same as <code>default_if</code>, but applies to any <em>collection</em> field in scope.</p>
<p><em>Scope:</em> Blueprint, view, partial, render</p>
<pre><code class="language-ruby">options[:collection_default_if] = -&gt;(ctx) { ctx.object.disabled? }
options[:collection_default_if] = :disabled?

def disabled?(ctx)
  ctx.object.disabled?
end
</code></pre>
<h2 id="conditional-fields"><a class="header" href="#conditional-fields">Conditional Fields</a></h2>
<h4 id="if"><a class="header" href="#if">if</a></h4>
<p>Only include the field if the given Proc or method name returns truthy.</p>
<p><em>Scope:</em> Field, object, collection</p>
<pre><code class="language-ruby">field :foo, if: -&gt;(ctx) { ctx.object.enabled? }
field :foo, if: :enabled?

def enabled?(ctx)
  ctx.object.enabled?
end
</code></pre>
<h4 id="field_if"><a class="header" href="#field_if">field_if</a></h4>
<p>Only include <em>regular</em> fields if the given Proc or method name returns truthy.</p>
<p><em>Scope:</em> Blueprint, view, partial, render</p>
<pre><code class="language-ruby">options[:field_if] = -&gt;(ctx) { ctx.object.enabled? }
options[:field_if] = :enabled?

def enabled?(ctx)
  ctx.object.enabled?
end
</code></pre>
<h4 id="object_if"><a class="header" href="#object_if">object_if</a></h4>
<p>Only include <em>object</em> fields if the given Proc or method name returns truthy.</p>
<p><em>Scope:</em> Blueprint, view, partial, render</p>
<pre><code class="language-ruby">options[:object_if] = -&gt;(ctx) { ctx.object.enabled? }
options[:object_if] = :enabled?

def enabled?(ctx)
  ctx.object.enabled?
end
</code></pre>
<h4 id="collection_if"><a class="header" href="#collection_if">collection_if</a></h4>
<p>Only include <em>collection</em> fields if the given Proc or method name returns truthy.</p>
<p><em>Scope:</em> Blueprint, view, partial, render</p>
<pre><code class="language-ruby">options[:collection_if] = -&gt;(ctx) { ctx.object.enabled? }
options[:collection_if] = :enabled?

def enabled?(ctx)
  ctx.object.enabled?
end
</code></pre>
<h4 id="unless"><a class="header" href="#unless">unless</a></h4>
<p>Inverse of <code>if</code>.</p>
<p><em>Scope:</em> Field, object, collection</p>
<h4 id="field_unless"><a class="header" href="#field_unless">field_unless</a></h4>
<p>Inverse of <code>field_if</code>.</p>
<p><em>Scope:</em> Blueprint, view, partial, render</p>
<h4 id="object_unless"><a class="header" href="#object_unless">object_unless</a></h4>
<p>Inverse of <code>object_if</code>.</p>
<p><em>Scope:</em> Blueprint, view, partial, render</p>
<h4 id="collection_unless"><a class="header" href="#collection_unless">collection_unless</a></h4>
<p>Inverse of <code>collection_if</code>.</p>
<p><em>Scope:</em> Blueprint, view, partial, render</p>
<h4 id="exclude_if_nil"><a class="header" href="#exclude_if_nil">exclude_if_nil</a></h4>
<p>Exclude fields if they're nil.</p>
<p><em>Scope:</em> Blueprint, view, partial, field, object, collection, render</p>
<pre><code class="language-ruby">options[:exclude_if_nil] = true

field :description, exclude_if_nil: true
</code></pre>
<h4 id="exclude_if_empty"><a class="header" href="#exclude_if_empty">exclude_if_empty</a></h4>
<p>Exclude fields if they're nil, or if they respond to <code>empty?</code> and it returns true.</p>
<p><em>Scope:</em> Blueprint, view, partial, field, object, collection, render</p>
<pre><code class="language-ruby">options[:exclude_if_empty] = true

field :description, exclude_if_empty: true
</code></pre>
<h2 id="other"><a class="header" href="#other">Other</a></h2>
<h4 id="extractor"><a class="header" href="#extractor">extractor</a></h4>
<p><em>Scope:</em> Blueprint, view, partial, field, object, collection</p>
<h4 id="root"><a class="header" href="#root">root</a></h4>
<p><em>Scope:</em> Blueprint, view, partial, render</p>
<h4 id="meta"><a class="header" href="#meta">meta</a></h4>
<p><em>Scope:</em> Blueprint, view, partial, render</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="extensions"><a class="header" href="#extensions">Extensions</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rendering"><a class="header" href="#rendering">Rendering</a></h1>
<pre><code class="language-ruby"># Render the default view
data = WidgetBlueprint.render(widget)
# or
data = WidgetBlueprint[:default].render(widget)

# Render a view
data = WidgetBlueprint[:extended].render(widget)

# Render a nested view
data = WidgetBlueprint["extended.price"].render(widget)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="blueprinter-api"><a class="header" href="#blueprinter-api">Blueprinter API</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="extensions-1"><a class="header" href="#extensions-1">Extensions</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="reflections"><a class="header" href="#reflections">Reflections</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="extractors"><a class="header" href="#extractors">Extractors</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="updating-to-v2"><a class="header" href="#updating-to-v2">Updating to V2</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="legacyv1-docs"><a class="header" href="#legacyv1-docs">Legacy/V1 Docs</a></h1>
<p>TODO copy from old README</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
