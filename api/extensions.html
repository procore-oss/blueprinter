<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Extensions - Blueprinter</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../theme/hljs-overrides.css">


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Blueprinter</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/procore-oss/blueprinter" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="extensions"><a class="header" href="#extensions">Extensions</a></h1>
<p>Blueprinter has a powerful extension system with hooks for every step of the serialization lifecycle. In fact, many of Blueprinter's features are implemented as built-in extensions!</p>
<p>Simply extend the <code>Blueprinter::Extension</code> class, define the hooks you need, and <a href="../dsl/extensions.html#using-extensions">add it to your configuration</a>.</p>
<pre><code class="language-ruby">class MyExtension &lt; Blueprinter::Extension
  # Use the exclude_field? hook to exclude certain fields on Tuesdays
  def exclude_field?(ctx)
    ctx.field.options[:tuesday] == false &amp;&amp; Date.today.tuesday?
  end
end
</code></pre>
<h2 id="hooks"><a class="header" href="#hooks">Hooks</a></h2>
<p>Hooks are called in the following order. Most are passed a <a href="./context-objects.html">context object</a> as an argument.</p>
<ul>
<li><a href="#collection">collection?</a></li>
<li><a href="#around">around</a>
<ul>
<li><a href="#input_object">input_object</a> | <a href="#input_collection">input_collection</a></li>
<li><a href="#around_blueprint">around_blueprint</a>
<ul>
<li><a href="#prepare">prepare</a></li>
<li><a href="#blueprint_fields">blueprint_fields</a></li>
<li><a href="#blueprint_input">blueprint_input</a></li>
<li><a href="#field_value">field_value</a> | <a href="#object_value">object_value</a> | <a href="#collection_value">collection_value</a></li>
<li><a href="#exclude_field">exclude_field?</a> | <a href="#exclude_object">exclude_object?</a> | <a href="#exclude_collection">exclude_collection?</a></li>
<li><a href="#blueprint_output">blueprint_output</a></li>
</ul>
</li>
<li><a href="#output_object">output_object</a> | <a href="#output_collection">output_collection</a></li>
</ul>
</li>
</ul>
<h2 id="collection"><a class="header" href="#collection">collection?</a></h2>
<blockquote>
<p><strong>@param Object</strong> The object passed to <code>render</code><br />
<strong>@return Boolean</strong> Whether the object is a collection or a single item<br />
<strong>@cost</strong> Low - run exactly once per render (not called for <code>render_object</code> or <code>render_collection</code>)</p>
</blockquote>
<p>If any extension with this hook returns <code>true</code>, the object will be considered a collection and rendered as such. For example, the <a href="https://github.com/procore-oss/blueprinter-activerecord">blueprinter-activerecord</a> extension uses this hook to indicate that an <code>ActiveRecord::Relation</code> should be considered a collection.</p>
<pre><code class="language-ruby">def collection?(object)
  object.is_a? ArrayLikeThing
end
</code></pre>
<h2 id="around"><a class="header" href="#around">around</a></h2>
<blockquote>
<p><strong>@param Context</strong> Fields <code>blueprint</code>, <code>object</code>, <code>options</code>, <code>instances</code>, <code>store</code><br />
<strong>@cost</strong> Low - run exactly once per render</p>
</blockquote>
<p>Wraps the entire rendering process. Rendering happens during <code>yield</code>, allowing the hook to run code before and after the render. If <code>yield</code> is not called exactly one time, a <code>BlueprinterError</code> is thrown.</p>
<pre><code class="language-ruby">def around(ctx)
  # do something before render
  yield # render
  # do something after render
end
</code></pre>
<h2 id="input_object"><a class="header" href="#input_object">input_object</a></h2>
<blockquote>
<p><strong>@param Context</strong> Fields <code>blueprint</code>, <code>object</code>, <code>options</code>, <code>instances</code>, <code>store</code><br />
<strong>@return Object</strong> A new or modified version of <code>context.object</code><br />
<strong>@cost</strong> Low - run exactly once per render</p>
</blockquote>
<p>Run when <code>render</code> is called with a non-collection object, or when <code>render_object</code> is called. This hook allows you to modify the object before rendering, or even return a new one. <strong>Whatever object is returned will be rendered and used as context.object in subsequent hooks.</strong></p>
<pre><code class="language-ruby">def input_object(ctx)
  ctx.object
end
</code></pre>
<h2 id="input_collection"><a class="header" href="#input_collection">input_collection</a></h2>
<blockquote>
<p><strong>@param Context</strong> Fields <code>blueprint</code>, <code>object</code>, <code>options</code>, <code>instances</code>, <code>store</code><br />
<strong>@return Object</strong> A new or modified version of <code>context.object</code>, which will be array-like<br />
<strong>@cost</strong> Low - run exactly once per render</p>
</blockquote>
<p>Run when <code>render</code> is called with a collection object, or when <code>render_collection</code> is called. This hook allows you to modify the array-like object before rendering, or even return a new one. <strong>Whatever collection is returned will be rendered and used as context.object in subsequent hooks.</strong></p>
<pre><code class="language-ruby">def input_object(ctx)
  ctx.object
end
</code></pre>
<h2 id="around_blueprint"><a class="header" href="#around_blueprint">around_blueprint</a></h2>
<blockquote>
<p><strong>@param Context</strong> Fields <code>blueprint</code>, <code>object</code>, <code>options</code>, <code>instances</code>, <code>store</code><br />
<strong>@cost</strong> Medium - run every time any blueprint is rendered</p>
</blockquote>
<p>Wraps the rendering of a every blueprint. This could be the top-level blueprint or one from an association N levels deep. For collections, it will be called once for each item in the collection.</p>
<p>Rendering happens during <code>yield</code>, allowing the hook to run code before and after the render. If <code>yield</code> is not called exactly one time, a <code>BlueprinterError</code> is thrown.</p>
<pre><code class="language-ruby">def around_blueprint(ctx)
  # do something before render
  yield # render
  # do something after render
end
</code></pre>
<h2 id="prepare"><a class="header" href="#prepare">prepare</a></h2>
<blockquote>
<p><strong>@param Context</strong> Fields <code>blueprint</code>, <code>object</code>, <code>options</code>, <code>instances</code>, <code>store</code><br />
<strong>@cost</strong> Low - run once for <em>every blueprint class</em> during render</p>
</blockquote>
<p>Allows an extension to perform any expensive setup operations for a given blueprint class. <code>context.store</code> is a good place to cache data since it is shared across all hooks and extensions.</p>
<pre><code class="language-ruby">def prepare(ctx)
  ctx.store[:my_ext] ||= {}
  ctx.store[:my_ext][ctx.blueprint.object_id] = setup ctx
end
</code></pre>
<h2 id="blueprint_fields"><a class="header" href="#blueprint_fields">blueprint_fields</a></h2>
<blockquote>
<p><strong>@param Context</strong> Fields <code>blueprint</code>, <code>object</code>, <code>options</code>, <code>instances</code>, <code>store</code><br />
<strong>@return Array&lt;Field | ObjectField | Collection&gt;</strong> The fields you want to render in the order you want to render them<br />
<strong>@cost</strong> Low - run once for <em>every blueprint class</em> during render</p>
</blockquote>
<p>Customize the order fields are rendered in - or strip out certain fields entirely. The included, optional <a href="../dsl/extensions.html#field-order">Field Order extension</a> uses this hook.</p>
<p>The default behavior is to render all fields in the order they were defined.</p>
<p>This example uses the <a href="./reflection.html">Reflection API</a> to get the fields from the current view, then sort them by name:</p>
<pre><code class="language-ruby">def blueprint_fields(ctx)
  ref = ctx.blueprint.class.reflections[:default]
  ref.ordered.sort_by(&amp;:name)
end
</code></pre>
<h2 id="blueprint_input"><a class="header" href="#blueprint_input">blueprint_input</a></h2>
<blockquote>
<p><strong>@param Context</strong> Fields <code>blueprint</code>, <code>object</code>, <code>options</code>, <code>instances</code>, <code>store</code><br />
<strong>@return Object</strong> A new or modified version of <code>context.object</code><br />
<strong>@cost</strong> Medium - run every time any blueprint is rendered</p>
</blockquote>
<p>Run before each blueprint is rendered, allowing you to modify, or return a new, object used for the render. <strong>Whatever object is returned will be rendered and used as context.object in subsequent hooks.</strong></p>
<pre><code class="language-ruby">def blueprint_input(ctx)
  ctx.object
end
</code></pre>
<h2 id="field_value"><a class="header" href="#field_value">field_value</a></h2>
<blockquote>
<p><strong>@param Context</strong> Fields <code>blueprint</code>, <code>field</code>, <code>value</code>, <code>object</code>, <code>options</code>, <code>instances</code>, <code>store</code><br />
<strong>@return Object</strong> The value to be rendered<br />
<strong>@cost</strong> High - run for every field (not object or collection fields)</p>
</blockquote>
<p>Run after a field value is extracted from <code>context.object</code>. The extracted value is available in <code>context.value</code>. <strong>Whatever value you return is used as context.value in subsequent field_value hooks, then run through any formatters and rendered.</strong></p>
<pre><code class="language-ruby">def field_value(ctx)
  case ctx
  when String then ctx.strip
  else ctx.value
  end
end
</code></pre>
<h2 id="object_value"><a class="header" href="#object_value">object_value</a></h2>
<blockquote>
<p><strong>@param Context</strong> Fields <code>blueprint</code>, <code>field</code>, <code>value</code>, <code>object</code>, <code>options</code>, <code>instances</code>, <code>store</code><br />
<strong>@return Object</strong> The object to be rendered for this field<br />
<strong>@cost</strong> High - run for every object field</p>
</blockquote>
<p>Run after an object field value is extracted from <code>context.object</code>. The extracted value is available in <code>context.value</code>. <strong>Whatever value you return is used as context.value in subsequent object_value hooks, then rendered.</strong></p>
<pre><code class="language-ruby">def field_value(ctx)
  case ctx
  when String then ctx.strip
  else ctx.value
  end
end
</code></pre>
<h2 id="collection_value"><a class="header" href="#collection_value">collection_value</a></h2>
<blockquote>
<p><strong>@param Context</strong> Fields <code>blueprint</code>, <code>field</code>, <code>value</code>, <code>object</code>, <code>options</code>, <code>instances</code>, <code>store</code><br />
<strong>@return Object</strong> The array-like collection to be rendered for this field<br />
<strong>@cost</strong> High - run for every collection field</p>
</blockquote>
<p>Run after a collection field value is extracted from <code>context.object</code>. The extracted value is available in <code>context.value</code>. <strong>Whatever value you return is used as context.value in subsequent collection_value hooks, then rendered.</strong></p>
<pre><code class="language-ruby">def collection_value(ctx)
  ctx.value.compact
end
</code></pre>
<h2 id="exclude_field"><a class="header" href="#exclude_field">exclude_field?</a></h2>
<blockquote>
<p><strong>@param Context</strong> Fields <code>blueprint</code>, <code>field</code>, <code>value</code>, <code>object</code>, <code>options</code>, <code>instances</code>, <code>store</code><br />
<strong>@return Boolean</strong> Truthy to exclude the field from the output<br />
<strong>@cost</strong> High - run for every field (not object or collection fields)</p>
</blockquote>
<p>If any extension with this hook returns truthy, the field will be excluded from the output. The formatted field value is available in <code>context.value</code>.</p>
<pre><code class="language-ruby">def exclude_field?(ctx)
  ctx.field.options[:tuesday] == false &amp;&amp; Date.today.tuesday?
end
</code></pre>
<h2 id="exclude_object"><a class="header" href="#exclude_object">exclude_object?</a></h2>
<blockquote>
<p><strong>@param Context</strong> Fields <code>blueprint</code>, <code>field</code>, <code>value</code>, <code>object</code>, <code>options</code>, <code>instances</code>, <code>store</code><br />
<strong>@return Boolean</strong> Truthy to exclude the field from the output<br />
<strong>@cost</strong> High - run for every object field</p>
</blockquote>
<p>If any extension with this hook returns truthy, the object field will be excluded from the output. The field object value is available in <code>context.value</code>.</p>
<pre><code class="language-ruby">def exclude_field?(ctx)
  ctx.field.options[:tuesday] == false &amp;&amp; Date.today.tuesday?
end
</code></pre>
<h2 id="exclude_collection"><a class="header" href="#exclude_collection">exclude_collection?</a></h2>
<blockquote>
<p><strong>@param Context</strong> Fields <code>blueprint</code>, <code>field</code>, <code>value</code>, <code>object</code>, <code>options</code>, <code>instances</code>, <code>store</code><br />
<strong>@return Boolean</strong> Truthy to exclude the field from the output<br />
<strong>@cost</strong> High - run for every collection field</p>
</blockquote>
<p>If any extension with this hook returns truthy, the collection field will be excluded from the output. The field collection value is available in <code>context.value</code>.</p>
<pre><code class="language-ruby">def exclude_field?(ctx)
  ctx.field.options[:tuesday] == false &amp;&amp; Date.today.tuesday?
end
</code></pre>
<h2 id="blueprint_output"><a class="header" href="#blueprint_output">blueprint_output</a></h2>
<blockquote>
<p><strong>@param Context</strong> Fields <code>blueprint</code>, <code>value</code>, <code>object</code>, <code>options</code>, <code>instances</code>, <code>store</code><br />
<strong>@return Hash</strong> The Hash to use as this blueprint's serialized output<br />
<strong>@cost</strong> Medium - run every time any blueprint is rendered</p>
</blockquote>
<p>Run after each blueprint is serialized to a Hash, allowing you to modify the output. The Hash is available in <code>context.value</code>. <strong>Whatever Hash is returned will be used as the serialized output for this blueprint.</strong></p>
<pre><code class="language-ruby">def blueprint_output(ctx)
  ctx.value.merge({ extra: "data" })
end
</code></pre>
<h2 id="output_object"><a class="header" href="#output_object">output_object</a></h2>
<blockquote>
<p><strong>@param Context</strong> Fields <code>blueprint</code>, <code>value</code>, <code>object</code>, <code>options</code>, <code>instances</code>, <code>store</code><br />
<strong>@return Hash</strong> The Hash to use as the final serialized output<br />
<strong>@cost</strong> Low - run once per <code>render</code> (for objects) or <code>render_object</code></p>
</blockquote>
<p>Run after the top-level object is fully serialized to a Hash, allowing you to modify the output. The Hash is available in <code>context.value</code>. <strong>Whatever Hash is returned will be the final serialized output.</strong></p>
<pre><code class="language-ruby">def output_object(ctx)
  ctx.value.merge({ extra: "data" })
end
</code></pre>
<h2 id="output_collection"><a class="header" href="#output_collection">output_collection</a></h2>
<blockquote>
<p><strong>@param Context</strong> Fields <code>blueprint</code>, <code>value</code>, <code>object</code>, <code>options</code>, <code>instances</code>, <code>store</code><br />
<strong>@return Hash | Array<Hash></strong> The Hash, or array of Hashes, to use as tthe final serialized output<br />
<strong>@cost</strong> Low - run once per <code>render</code> (for collections) or <code>render_collection</code></p>
</blockquote>
<p>Run after the top-level collection is fully serialized to an array of Hashes, allowing you to modify the output. The array of Hashes is available in <code>context.value</code>. <strong>Whatever is returned will be the final serialized output.</strong></p>
<pre><code class="language-ruby"># Wrap the output array in a Hash
def output_collection(ctx)
  {
    data: ctx.value,
    extra: "metadata"
  }
end

# Or modify each element
def output_collection(ctx)
  ctx.value.map { |item| item.merge({ extra: "data" }) }
end
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../api/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../api/reflection.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../api/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../api/reflection.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
