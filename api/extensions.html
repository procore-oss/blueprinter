<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Extensions - Blueprinter</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../theme/hljs-overrides.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Blueprinter</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/procore-oss/blueprinter" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="extensions"><a class="header" href="#extensions">Extensions</a></h1>
<p>Blueprinter has a powerful extension system with hooks for every step of the serialization lifecycle. In fact, many of Blueprinter's features are implemented as built-in extensions!</p>
<p>Simply extend the <code>Blueprinter::Extension</code> class, define the hooks you need, and <a href="../dsl/extensions.html#using-extensions">add it to your configuration</a>.</p>
<pre><code class="language-ruby">class MyExtension &lt; Blueprinter::Extension
  # Use the exclude_field? hook to exclude certain fields on Tuesdays
  def exclude_field?(ctx) = ctx.field.options[:tues] == false &amp;&amp; Date.today.tuesday?
end

class MyBlueprint &lt; ApplicationBlueprint
  extensions &lt;&lt; MyExtension.new
end
</code></pre>
<p>Alternatively, you can define an extension direclty in your blueprint:</p>
<pre><code class="language-ruby">class MyBlueprint &lt; ApplicationBlueprint
  extension do
    def exclude_field?(ctx) = ctx.field.options[:tues] == false &amp;&amp; Date.today.tuesday?
  end
end
</code></pre>
<h2 id="hooks"><a class="header" href="#hooks">Hooks</a></h2>
<p>Hooks are called in the following order. They are passed a <a href="./context-objects.html">context object</a> as an argument.</p>
<ul>
<li><a href="#blueprint_fields">blueprint_fields</a></li>
<li><a href="#blueprint_setup">blueprint_setup</a></li>
<li><a href="#around_serialize_object">around_serialize_object</a> | <a href="#around_serialize_collection">around_serialize_collection</a>
<ul>
<li><a href="#object_input">object_input</a> | <a href="#collection_input">collection_input</a></li>
<li><a href="#blueprint_input">blueprint_input</a>
<ul>
<li><a href="#extract_value">extract_value</a></li>
<li><a href="#field_value">field_value</a> | <a href="#object_field_value">object_field_value</a> | <a href="#collection_field_value">collection_field_value</a></li>
<li><a href="#exclude_field">exclude_field?</a> | <a href="#exclude_object_field">exclude_object_field?</a> | <a href="#exclude_collection_field">exclude_collection_field?</a>
<ul>
<li><em>blueprint_fields …</em></li>
</ul>
</li>
<li><a href="#field_result">field_result</a> | <a href="#object_field_result">object_field_result</a> | <a href="#collection_field_result">collection_field_result</a></li>
</ul>
</li>
<li><a href="#blueprint_output">blueprint_output</a></li>
<li><a href="#object_output">object_output</a> | <a href="#collection_output">collection_output</a></li>
</ul>
</li>
<li><a href="#json">json</a></li>
</ul>
<p>Additionally, the <a href="#around_hook">around_hook</a> hook runs around all other hooks.</p>
<h4 id="chain-vs-override-hooks"><a class="header" href="#chain-vs-override-hooks">Chain vs override hooks</a></h4>
<p>Most hooks are <em>chained</em>; if you have N of the same hook, they run one after the other, using the output of one as input for the next. However, a few hooks are <em>override</em> hooks: only the last one runs. Override hooks are used to replace built-in functionality, like the JSON serializer.</p>
<h2 id="blueprint_fields"><a class="header" href="#blueprint_fields">blueprint_fields</a></h2>
<blockquote>
<p><em>Override hook</em><br />
<strong>@param <a href="./context-objects.html#render-context">Render Context</a></strong><br />
<strong>@cost</strong> Low - run once for <em>every blueprint class</em> during render</p>
</blockquote>
<p>Customize the order fields are rendered in - or strip out certain fields entirely. If multiple extensions define this hook, <em>only the last one</em> will be used. The included, optional <a href="../dsl/extensions.html#field-order">Field Order extension</a> uses this hook.</p>
<p>The default behavior is to render all fields in the order they were defined. The following example uses the <a href="./reflection.html">Reflection API</a> to get the fields from the current view, then sort them by name:</p>
<pre><code class="language-ruby">def blueprint_fields(ctx)
  ref = ctx.blueprint.class.reflections[:default]
  ref.ordered.sort_by(&amp;:name)
end
</code></pre>
<p>It's run once <em>per blueprint class</em> during a render. So if you're rendering an array of widgets with <code>WidgetBlueprint</code>, which contains <code>PartBlueprint</code>s and <code>CategoryBlueprint</code>s, this hook will be called <strong>three</strong> times: one for each of those blueprints.</p>
<p><a href="#hooks">↑ Back to Hooks</a></p>
<h2 id="blueprint_setup"><a class="header" href="#blueprint_setup">blueprint_setup</a></h2>
<blockquote>
<p><strong>@param <a href="./context-objects.html#render-context">Render Context</a></strong><br />
<strong>@cost</strong> Low - run once for <em>every blueprint class</em> during render</p>
</blockquote>
<p>Allows an extension to perform setup operations for the render of the current blueprint.</p>
<pre><code class="language-ruby">def blueprint_setup(ctx)
  # do setup for ctx.blueprint
end
</code></pre>
<p>It's run once <em>per blueprint class</em> during a render. So if you're rendering an array of widgets with <code>WidgetBlueprint</code>, which contains <code>PartBlueprint</code>s and <code>CategoryBlueprint</code>s, this hook will be called <strong>three</strong> times: one for each of those blueprints.</p>
<p><a href="#hooks">↑ Back to Hooks</a></p>
<h2 id="around_serialize_object"><a class="header" href="#around_serialize_object">around_serialize_object</a></h2>
<blockquote>
<p><strong>@param <a href="./context-objects.html#object-context">Object Context</a></strong> <code>context.object</code> will contain the current object being rendered<br />
<strong>@cost</strong> Medium - run every time any blueprint is rendered</p>
</blockquote>
<p>Wraps the rendering of every object (<code>context.object</code>). This could be the top-level object or one from an association N levels deep (check <code>context.depth</code>).</p>
<p>Rendering happens during <code>yield</code>, allowing the hook to run code before and after the render. If <code>yield</code> is not called exactly one time, a <code>BlueprinterError</code> is thrown.</p>
<pre><code class="language-ruby">def around_serialize_object(ctx)
  # do something before render
  yield # render
  # do something after render
end
</code></pre>
<p><a href="#hooks">↑ Back to Hooks</a></p>
<h2 id="around_serialize_collection"><a class="header" href="#around_serialize_collection">around_serialize_collection</a></h2>
<blockquote>
<p><strong>@param <a href="./context-objects.html#object-context">Object Context</a></strong> <code>context.object</code> will contain the current collection being rendered<br />
<strong>@cost</strong> Medium - run every time any blueprint is rendered</p>
</blockquote>
<p>Wraps the rendering of every collection (<code>context.object</code>). This could be the top-level collection or one from an association N levels deep (check <code>context.depth</code>).</p>
<p>Rendering happens during <code>yield</code>, allowing the hook to run code before and after the render. If <code>yield</code> is not called exactly one time, a <code>BlueprinterError</code> is thrown.</p>
<pre><code class="language-ruby">def around_serialize_collection(ctx)
  # do something before render
  yield # render
  # do something after render
end
</code></pre>
<p><a href="#hooks">↑ Back to Hooks</a></p>
<h2 id="object_input"><a class="header" href="#object_input">object_input</a></h2>
<blockquote>
<p><strong>@param <a href="./context-objects.html#object-context">Object Context</a></strong> <code>context.object</code> will contain the current object being rendered<br />
<strong>@return Object</strong> A new or modified version of <code>context.object</code><br />
<strong>@cost</strong> Medium - run every time an object is rendered</p>
</blockquote>
<p>Run before serialization begins on an object passed to <code>render</code> or <code>render_object</code>, or an <code>object</code> in a blueprint. You may modify and return <code>context.object</code> or return a different object entirely. <strong>Whatever object is returned will be used as context.object in subsequent hooks, then rendered.</strong></p>
<pre><code class="language-ruby">def object_input(ctx)
  ctx.object
end
</code></pre>
<p><a href="#hooks">↑ Back to Hooks</a></p>
<h2 id="collection_input"><a class="header" href="#collection_input">collection_input</a></h2>
<blockquote>
<p><strong>@param <a href="./context-objects.html#object-context">Object Context</a></strong> <code>context.object</code> will contain the current collection being rendered<br />
<strong>@return Object</strong> A new or modified version of <code>context.object</code>, which will be array-like<br />
<strong>@cost</strong> Medium - run every time a collection is rendered</p>
</blockquote>
<p>Run before serialization begins on a collection passed to <code>render</code> or <code>render_collection</code>, or a <code>collection</code> in a blueprint. You may modify and return <code>context.object</code> or return a different collection entirely. <strong>Whatever collection is returned will be used as context.object in subsequent hooks, then rendered.</strong></p>
<pre><code class="language-ruby">def collection_input(ctx)
  ctx.object
end
</code></pre>
<p><a href="#hooks">↑ Back to Hooks</a></p>
<h2 id="blueprint_input"><a class="header" href="#blueprint_input">blueprint_input</a></h2>
<blockquote>
<p><strong>@param <a href="./context-objects.html#object-context">Object Context</a></strong> <code>context.object</code> will contain the current object being rendered<br />
<strong>@return Object</strong> A new or modified version of <code>context.object</code><br />
<strong>@cost</strong> Medium - run every time any blueprint is rendered</p>
</blockquote>
<p>Run each time a blueprint renders, allowing you to modify or return a new object (<code>context.object</code>) used for the render. For collections of size N, it will be called N times. <strong>Whatever object is returned will be used as context.object in subsequent hooks, then rendered.</strong></p>
<pre><code class="language-ruby">def blueprint_input(ctx)
  ctx.object
end
</code></pre>
<p><a href="#hooks">↑ Back to Hooks</a></p>
<h2 id="extract_value"><a class="header" href="#extract_value">extract_value</a></h2>
<blockquote>
<p><em>Override hook</em><br />
<strong>@param <a href="./context-objects.html#field-context">Field Context</a></strong> <code>context.field</code> will contain the current field being serialized, and <code>context.object</code> the current object<br />
<strong>@return Object</strong> The value for the field<br />
<strong>@cost</strong> High - run for every field, object, and collection</p>
</blockquote>
<p>Called on each field, object, and collection. The return value is used as <code>context.value</code> in subsequent hooks. If multiple extensions define this hook, <em>only the last one</em> will be used.</p>
<pre><code class="language-ruby">def extract_value(ctx)
  ctx.object.public_send(ctx.field.from)
end
</code></pre>
<p><a href="#hooks">↑ Back to Hooks</a></p>
<h2 id="field_value"><a class="header" href="#field_value">field_value</a></h2>
<blockquote>
<p><strong>@param <a href="./context-objects.html#field-context">Field Context</a></strong> <code>context.field</code> will contain the current field being serialized, and <code>context.object</code> the current object<br />
<strong>@return Object</strong> The value to be rendered<br />
<strong>@cost</strong> High - run for every field (not object or collection fields)</p>
</blockquote>
<p>Run after a field value is extracted from <code>context.object</code>. The extracted value is available in <code>context.value</code>. <strong>Whatever value you return is used as context.value in subsequent field_value hooks, then run through any formatters and rendered.</strong></p>
<pre><code class="language-ruby">def field_value(ctx)
  case ctx.value
  when String then ctx.value.strip
  else ctx.value
  end
end
</code></pre>
<p><a href="#hooks">↑ Back to Hooks</a></p>
<h2 id="object_field_value"><a class="header" href="#object_field_value">object_field_value</a></h2>
<blockquote>
<p><strong>@param <a href="./context-objects.html#field-context">Field Context</a></strong> <code>context.field</code> will contain the current field being serialized, and <code>context.object</code> the current object<br />
<strong>@return Object</strong> The object to be rendered for this field<br />
<strong>@cost</strong> High - run for every object field</p>
</blockquote>
<p>Run after an object field value is extracted from <code>context.object</code>. The extracted value is available in <code>context.value</code>. <strong>Whatever value you return is used as context.value in subsequent object_field_value hooks, then rendered.</strong></p>
<pre><code class="language-ruby">def object_field_value(ctx)
  ctx.value
end
</code></pre>
<p><a href="#hooks">↑ Back to Hooks</a></p>
<h2 id="collection_field_value"><a class="header" href="#collection_field_value">collection_field_value</a></h2>
<blockquote>
<p><strong>@param <a href="./context-objects.html#field-context">Field Context</a></strong> <code>context.field</code> will contain the current field being serialized, and <code>context.object</code> the current object<br />
<strong>@return Object</strong> The array-like collection to be rendered for this field<br />
<strong>@cost</strong> High - run for every collection field</p>
</blockquote>
<p>Run after a collection field value is extracted from <code>context.object</code>. The extracted value is available in <code>context.value</code>. <strong>Whatever value you return is used as context.value in subsequent collection_field_value hooks, then rendered.</strong></p>
<pre><code class="language-ruby">def collection_field_value(ctx)
  ctx.value.compact
end
</code></pre>
<p><a href="#hooks">↑ Back to Hooks</a></p>
<h2 id="exclude_field"><a class="header" href="#exclude_field">exclude_field?</a></h2>
<blockquote>
<p><strong>@param <a href="./context-objects.html#field-context">Field Context</a></strong> <code>context.field</code> will contain the current field being serialized, and <code>context.object</code> the current object<br />
<strong>@return Boolean</strong> Truthy to exclude the field from the output<br />
<strong>@cost</strong> High - run for every field (not object or collection fields)</p>
</blockquote>
<p>If any extension with this hook returns truthy, the field will be excluded from the output. The formatted field value is available in <code>context.value</code>.</p>
<pre><code class="language-ruby">def exclude_field?(ctx)
  ctx.field.options[:tuesday] == false &amp;&amp; Date.today.tuesday?
end
</code></pre>
<p><a href="#hooks">↑ Back to Hooks</a></p>
<h2 id="exclude_object_field"><a class="header" href="#exclude_object_field">exclude_object_field?</a></h2>
<blockquote>
<p><strong>@param <a href="./context-objects.html#field-context">Field Context</a></strong> <code>context.field</code> will contain the current field being serialized, and <code>context.object</code> the current object<br />
<strong>@return Boolean</strong> Truthy to exclude the field from the output<br />
<strong>@cost</strong> High - run for every object field</p>
</blockquote>
<p>If any extension with this hook returns truthy, the object field will be excluded from the output. The field object value is available in <code>context.value</code>.</p>
<pre><code class="language-ruby">def exclude_object_field?(ctx)
  ctx.field.options[:tuesday] == false &amp;&amp; Date.today.tuesday?
end
</code></pre>
<p><a href="#hooks">↑ Back to Hooks</a></p>
<h2 id="exclude_collection_field"><a class="header" href="#exclude_collection_field">exclude_collection_field?</a></h2>
<blockquote>
<p><strong>@param <a href="./context-objects.html#field-context">Field Context</a></strong> <code>context.field</code> will contain the current field being serialized, and <code>context.object</code> the current object<br />
<strong>@return Boolean</strong> Truthy to exclude the field from the output<br />
<strong>@cost</strong> High - run for every collection field</p>
</blockquote>
<p>If any extension with this hook returns truthy, the collection field will be excluded from the output. The field collection value is available in <code>context.value</code>.</p>
<pre><code class="language-ruby">def exclude_collection_field?(ctx)
  ctx.field.options[:tuesday] == false &amp;&amp; Date.today.tuesday?
end
</code></pre>
<p><a href="#hooks">↑ Back to Hooks</a></p>
<h2 id="field_result"><a class="header" href="#field_result">field_result</a></h2>
<p>TODO</p>
<p><a href="#hooks">↑ Back to Hooks</a></p>
<h2 id="object_field_result"><a class="header" href="#object_field_result">object_field_result</a></h2>
<p>TODO</p>
<p><a href="#hooks">↑ Back to Hooks</a></p>
<h2 id="collection_field_result"><a class="header" href="#collection_field_result">collection_field_result</a></h2>
<p>TODO</p>
<p><a href="#hooks">↑ Back to Hooks</a></p>
<h2 id="blueprint_output"><a class="header" href="#blueprint_output">blueprint_output</a></h2>
<blockquote>
<p><strong>@param <a href="./context-objects.html#result-context">Result Context</a></strong> <code>context.result</code> will contain the serialized Hash from the current blueprint, and <code>context.object</code> the current object<br />
<strong>@return Hash</strong> The Hash to use as this blueprint's serialized output<br />
<strong>@cost</strong> Medium - run every time any blueprint is rendered</p>
</blockquote>
<p>Run after a blueprint serializes an object to a Hash, allowing you to modify the output. The Hash is available in <code>context.result</code>. For collections of size N, it will be called N times. <strong>Whatever Hash is returned will be used as context.result in subsequent hooks and used as the serialized output for this blueprint.</strong></p>
<pre><code class="language-ruby">def blueprint_output(ctx)
  ctx.result.merge(ctx.object.extra_fields)
end
</code></pre>
<p><a href="#hooks">↑ Back to Hooks</a></p>
<h2 id="object_output"><a class="header" href="#object_output">object_output</a></h2>
<blockquote>
<p><strong>@param <a href="./context-objects.html#result-context">Result Context</a></strong> <code>context.result</code> will contain the serialized Hash from the current blueprint, and <code>context.object</code> the current object<br />
<strong>@return [Object]</strong> The value to use for the fully serialized object<br />
<strong>@cost</strong> High - run for every object field</p>
</blockquote>
<p>Run after an object is fully serialized. This may be the root object from <code>render</code> or an <code>object</code> field from a blueprint. This example wraps the result in a metadata block:</p>
<pre><code class="language-ruby">def object_output(ctx)
  { data: ctx.value, metadata: {...} }
end
</code></pre>
<p><a href="#hooks">↑ Back to Hooks</a></p>
<h2 id="collection_output"><a class="header" href="#collection_output">collection_output</a></h2>
<blockquote>
<p><strong>@param <a href="./context-objects.html#result-context">Result Context</a></strong> <code>context.result</code> will contain the array of serialized Hashes from the current blueprint, and <code>context.object</code> the current collection<br />
<strong>@return [Object]</strong> The value to use for the fully serialized collection<br />
<strong>@cost</strong> High - run for every collection field</p>
</blockquote>
<p>Run after a collection is fully serialized. This may be the root collection from <code>render</code> or a <code>collection</code> field from a blueprint. This example wraps the result in a metadata block:</p>
<pre><code class="language-ruby">def collection_output(ctx)
  { data: ctx.value, metadata: {...} }
end
</code></pre>
<p><a href="#hooks">↑ Back to Hooks</a></p>
<h2 id="json"><a class="header" href="#json">json</a></h2>
<blockquote>
<p><em>Override hook</em><br />
<strong>@param <a href="./context-objects.html#result-context">Result Context</a></strong> <code>context.result</code> will contain the serialized Hash or array from the top-level blueprint, and <code>context.object</code> the top-level object or collection<br />
<strong>@return String</strong> The JSON output<br />
<strong>@cost</strong> Low - run once per JSON render</p>
</blockquote>
<p>Serializes the final output to JSON. If multiple extensions define this hook, <em>only the last one</em> will be used.</p>
<p>The default behavior looks like:</p>
<pre><code class="language-ruby">def json(ctx)
  JSON.dump ctx.result
end
</code></pre>
<p><a href="#hooks">↑ Back to Hooks</a></p>
<h2 id="around_hook"><a class="header" href="#around_hook">around_hook</a></h2>
<blockquote>
<p><strong>@param Extension</strong> Instance of the extension<br />
<strong>@param Symbol</strong> Name of the hook<br />
<strong>@cost</strong> Variable - Depends on what hooks your extensions implement</p>
</blockquote>
<p>A special hook that runs around all other extension hooks. Useful for instrumenting. You can exclude an extension's hooks from this hook by putting <code>def hidden? = true</code> in the extension.</p>
<pre><code class="language-ruby">def around_hook(ext, hook)
  # Do something before extension hook runs
  yield # hook runs here
  # Do something after extension hook runs
end
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../api/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../api/reflection.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../api/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../api/reflection.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
