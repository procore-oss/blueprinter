<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Blueprinter</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon-bc91b3a9.svg">
        <link rel="stylesheet" href="css/variables-8adf115d.css">
        <link rel="stylesheet" href="css/general-2459343d.css">
        <link rel="stylesheet" href="css/chrome-ae938929.css">
        <link rel="stylesheet" href="css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="theme/hljs-overrides-ac35c0bd.css">
        <link rel="stylesheet" href="theme/custom-e18203ad.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex-f04616ff.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc-f275a713.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">Blueprinter</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>
                        <a href="https://github.com/procore-oss/blueprinter" title="Git repository" aria-label="Git repository">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <h1 id="blueprinter"><a class="header" href="#blueprinter">Blueprinter</a></h1>
<blockquote class="blockquote-tag blockquote-tag-warning">
<p class="blockquote-tag-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>Warning</p>
<p>This is a WIP for API V2!</p>
</blockquote>
<p>Blueprinter is a JSON serializer for your business objects. It is designed to be simple, flexible, and performant.</p>
<p>Upgrading from 1.x? <a href="#upgrading-to-api-v2">Read the upgrade guide!</a></p>
<h3 id="installation"><a class="header" href="#installation">Installation</a></h3>
<pre><code class="language-bash">bundle add blueprinter
</code></pre>
<p>See <a href="https://www.rubydoc.info/gems/blueprinter">rubydoc.info/gems/blueprinter</a> for generated API documentation.</p>
<h3 id="basic-usage"><a class="header" href="#basic-usage">Basic Usage</a></h3>
<pre><code class="language-ruby">class WidgetBlueprint &lt; ApplicationBlueprint
  field :name
  object :category, CategoryBlueprint
  collection :parts, PartBlueprint

  view :extended do
    field :description
    object :manufacturer, CompanyBlueprint
    collection :vendors, CompanyBlueprint
  end
end

# Render the default view to JSON
WidgetBlueprint.render(widget).to_json

# Render the extended view to a Hash
WidgetBlueprint[:extended].render(widget).to_hash
</code></pre>
<p>Look interesting? <a href="#blueprinter-dsl">Learn the DSL!</a></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="blueprinter-dsl"><a class="header" href="#blueprinter-dsl">Blueprinter DSL</a></h1>
<h2 id="define-your-base-class"><a class="header" href="#define-your-base-class">Define your base class</a></h2>
<p>Define an <code>ApplicationBlueprint</code> for your blueprints to inherit from. Any global configuration goes here: common <a href="#fields">fields</a>, <a href="#views">views</a>, <a href="#partials">partials</a>, <a href="#formatters">formatters</a>, <a href="#extensions">extensions</a>, and <a href="#options-1">options</a>.</p>
<pre><code class="language-ruby">class ApplicationBlueprint &lt; Blueprinter::Blueprint
  extensions &lt;&lt; MyExtension.new
  options[:exclude_if_nil] = true
  field :id
end
</code></pre>
<h2 id="define-blueprints-for-your-models"><a class="header" href="#define-blueprints-for-your-models">Define blueprints for your models</a></h2>
<p>This blueprint inherits everything from <code>ApplicationBlueprint</code>, then adds a <code>name</code> field and two associations that will render using other blueprints.</p>
<pre><code class="language-ruby">class WidgetBlueprint &lt; ApplicationBlueprint
  field :name
  object :category, CategoryBlueprint
  collection :parts, PartBlueprint
end
</code></pre>
<p>There’s a lot more you can do with the Blueprinter DSL. <a href="#fields">Fields</a> are a good place to start!</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="fields"><a class="header" href="#fields">Fields</a></h1>
<pre><code class="language-ruby"># Use field for scalar values, arrays of scalar values, or even a Hash
field :name
field :tags

# Add multiple fields at once
fields :description, :price

# Use object to render an object or Hash using another blueprint
object :category, CategoryBlueprint

# Use collection to render an array-like collection of objects
collection :parts, PartBlueprint
</code></pre>
<h2 id="options"><a class="header" href="#options">Options</a></h2>
<p>Fields accept a wide array of built-in options, and <a href="#extensions">extensions</a> can define even more. <a href="#options-1">Find all built-in options here.</a></p>
<pre><code class="language-ruby">field :description, default: "No description"
collection :parts, PartBlueprint, exclude_if_empty: true
</code></pre>
<h2 id="extracting-field-values"><a class="header" href="#extracting-field-values">Extracting field values</a></h2>
<p>Blueprinter is pretty smart about extracting field values from objects and Hashes, but there are ways to customize the behavior if needed.</p>
<h3 id="default-behavior"><a class="header" href="#default-behavior">Default behavior</a></h3>
<ul>
<li>For Hashes, Blueprinter will look for a key matching the field name - first with a Symbol, then a String.</li>
<li>For anything else, Blueprinter will look for a public method matching the field name.</li>
<li>The <a href="#from">from</a> field option can be used to specify a different method or Hash key name.</li>
</ul>
<h3 id="field-blocks"><a class="header" href="#field-blocks">Field blocks</a></h3>
<p>If you pass a block to your field, the default behavior will be bypassed and the block’s return value will be used. It will be passed a <a href="#field-context">Field context</a> argument containing the object being rendered, among other things.</p>
<pre><code class="language-ruby">field :description do |object, ctx|
  object.description.upcase
end

# Blocks can call instance methods defined on your Blueprint
collection :parts, PartBlueprint do |object, ctx|
  active_parts object
end

def active_parts(object)
  object.parts.select(&amp;:active?)
end
</code></pre>
<h3 id="extracting-with-extensions"><a class="header" href="#extracting-with-extensions">Extracting with extensions</a></h3>
<p>The <a href="#around_field_value">around_field_value</a>, <a href="#around_object_value">around_object_value</a>, and <a href="#around_collection_value">around_collection_value</a> middleware hooks can intercept extraction and return whatever values they want. <a href="#extensions">Learn more about using extensions</a>.</p>
<pre><code class="language-ruby">class MyExtractor &lt; Blueprinter::Extension
  def around_field_value(ctx)
    if ctx.field.options[:my_extractor] || ctx.blueprint.class.options[:my_extractor]
      # If the field or blueprint has the "my_extractor" option, use custom extraction
      my_custom_extraction(ctx.object, ctx.field)
    else
      # Otherwise use the default behavior
      yield ctx
    end
  end

  private

  def my_custom_extraction(object, field)
    # ...
  end
end
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="views"><a class="header" href="#views">Views</a></h1>
<p>Blueprints can define views to provide different representations of the data. A view inherits everything from its parent but is free to override as needed. In addition to <a href="#fields">fields</a>, views can define <a href="#options-1">options</a>, <a href="#partials">partials</a>, <a href="#formatters">formatters</a>, <a href="#extensions">extensions</a>, and <a href="#nesting-views">nested views</a>.</p>
<pre><code class="language-ruby">class WidgetBlueprint &lt; ApplicationBlueprint
  field :name
  object :category, CategoryBlueprint

  # The "with_parts" view inherits from "default" and adds a collection of parts
  view :with_parts do
    collection :parts, PartBlueprint
  end

  # Views can include other views
  view :full do
    use :with_parts
    field :description
  end
end
</code></pre>
<p>At the top level of every Blueprint is an implicit view called <code>default</code>. The default view is used when no other is specified. All other views in the Blueprint inherit from it.</p>
<h3 id="nesting-views"><a class="header" href="#nesting-views">Nesting views</a></h3>
<p>You can nest views within views, allowing for a hierarchy of inheritance.</p>
<pre><code class="language-ruby">class WidgetBlueprint &lt; ApplicationBlueprint
  field :name
  object :category, CategoryBlueprint

  view :extended do
    field :description
    collection :parts, PartBlueprint

    # The "extended.with_price" view adds a price field
    view :with_price do
      field :price
    end
  end
</code></pre>
<h3 id="excluding-fields"><a class="header" href="#excluding-fields">Excluding fields</a></h3>
<p>Views can exclude select fields from parents, views they’ve included, or from <a href="#partials">partials</a>.</p>
<pre><code class="language-ruby">class WidgetBlueprint &lt; ApplicationBlueprint
  fields :name, :description, :price

  view :minimal do
    exclude :description, :price
  end
end
</code></pre>
<p>You can exclude and and all parent fields by creating an empty view:</p>
<pre><code class="language-ruby">class WidgetBlueprint &lt; ApplicationBlueprint
  fields :name, :description, :price

  view :minimal, empty: true do
    field :the_only_field
  end
end
</code></pre>
<h3 id="referencing-views"><a class="header" href="#referencing-views">Referencing views</a></h3>
<p>When defining an association, you can choose a view from its blueprint:</p>
<pre><code class="language-ruby">object :widget, WidgetBlueprint[:extended]
</code></pre>
<p>Nested views can be accessed with a dot syntax or a nested Hash syntax.</p>
<pre><code class="language-ruby">collection :widgets, WidgetBlueprint["extended.with_price"]
collection :widgets, WidgetBlueprint[:extended][:with_price]
</code></pre>
<h3 id="inheriting-from-views"><a class="header" href="#inheriting-from-views">Inheriting from views</a></h3>
<p>You can inherit from another blueprint, or from one of its views:</p>
<pre><code class="language-ruby">class WidgetBlueprint &lt; ApplicationBlueprint[:with_timestamps]
  # ...
end
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="partials"><a class="header" href="#partials">Partials</a></h1>
<p>Partials allow you to compose views from reusable components. Just like views, partials can define <a href="#fields">fields</a>, <a href="#options-1">options</a>, <a href="#views">views</a>, other <a href="#partials">partials</a>, <a href="#formatters">formatters</a>, and <a href="#extensions">extensions</a>.</p>
<pre><code class="language-ruby">class WidgetBlueprint &lt; ApplicationBlueprint
  field :name

  view :foo do
    use :associations
    field :foo
  end

  view :bar do
    use :associations, :description
    field :bar
  end

  partial :associations do
    object :category, CategoryBlueprint
    collection :parts, PartBlueprint
  end

  partial :description do
    field :description
  end
end
</code></pre>
<p>There are two ways of including partials: <a href="#append-with-use">appending with ‘use’</a> and <a href="#inserting-with-use">inserting with ‘use!’</a> (see <a href="#examples-of-use-and-use">examples</a>).</p>
<h3 id="append-with-use"><a class="header" href="#append-with-use">Append with ‘use’</a></h3>
<p>Partials are <em>appended</em> to your view, giving them the opportunity to override your view’s fields, options, etc. Precedence (highest to lowest) is:</p>
<ol>
<li>Definitions in the partial</li>
<li>Definitions in the view</li>
<li>Definitions inherited from the blueprint/parent views</li>
</ol>
<h3 id="insert-with-use"><a class="header" href="#insert-with-use">Insert with ‘use!’</a></h3>
<p>Partials are embedded immediately, <em>on that line</em>, allowing subsequent lines to override the partial. Precedence (highest to lowest) is:</p>
<ol>
<li>Definitions in the view <em>after</em> <code>use!</code></li>
<li>Definitions in the partial</li>
<li>Definitions in the view <em>before</em> <code>use!</code></li>
<li>Definitions inherited from the blueprint/parent views</li>
</ol>
<h3 id="examples-of-use-and-use"><a class="header" href="#examples-of-use-and-use">Examples of ‘use’ and ‘use!’</a></h3>
<pre><code class="language-ruby">partial :no_empty_fields do
  options[:field_if] = :og_field_logic
  # other stuff
end

# :foo appends the partial, so it overrides the view's field_if
view :foo do
  use :no_empty_fields
  options[:field_if] = :other_field_logic
end

# :bar inserts the partial, but the next line overrides the partial's field_if
view :bar do
  use! :no_empty_fields
  options[:field_if] = :other_field_logic
end
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="formatters"><a class="header" href="#formatters">Formatters</a></h1>
<p>Declaratively format field values by class. You can define formatters anywhere in your blueprints: top level, <a href="#views">views</a>, and <a href="#partials">partials</a>.</p>
<pre><code class="language-ruby">class WidgetBlueprint &lt; ApplicationBlueprint
  # Strip whitespace from all strings
  format(String) { |val| val.strip }

  # Format all dates and times using ISO-8601
  format Date, :iso8601
  format Time, :iso8601

  def iso8601(val)
    val.iso8601
  end
end
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="options-1"><a class="header" href="#options-1">Options</a></h1>
<p>Numerous options can be defined on Blueprints, views, partials, or individual fields. Some can also be passed to <code>render</code>.</p>
<pre><code class="language-ruby">class WidgetBlueprint &lt; ApplicationBlueprint
  # Blueprint options apply to all fields, associations, views, and partials in
  # the Blueprint. They are inherited from the parent class but can be overridden.
  options[:exclude_if_empty] = true

  # Field options apply to individual fields or associations. They can override
  # Blueprint options.
  field :name, exclude_if_empty: false

  # Options in views apply to all fields, associations, partials and nested views
  # in the view. They inherit options from the Blueprint, or from parent views,
  # and can override them.
  view :foo do
    options[:exclude_if_empty] = false
  end

  # Options in partials apply to all fields, associations, views, and partials in
  # the partial. All of these are applied to the views that use the partial.
  partial :bar do
    options[:exclude_if_empty] = false
  end

  # Some options accept Procs/labmdas. These can call instance methods defined on
  # your Blueprint. Or you can pass a method name as a symbol.
  field :foo, if: -&gt;(ctx) { long_complex_check? ctx }
  field :bar, if: :long_complex_check?

  def long_complex_check?(ctx)
    # ...
  end
end

# Passing a supported option to render will override what's in the blueprint
WidgetBlueprint.render(widget, exclude_if_empty: false).to_json
</code></pre>
<p>For easier reference, options are grouped into the following categories:</p>
<ul>
<li><a href="#default-values">Default values</a>: Provide defaults for empty fields</li>
<li><a href="#conditional-fields">Conditional fields</a>: Exclude fields based on conditions</li>
<li><a href="#field-mapping">Field mapping</a>: Change how field values are extracted from objects</li>
<li><a href="#other">Metadata</a>: Wrap or add metadata to the output</li>
</ul>
<h4 id="a-note-about-context-objects"><a class="header" href="#a-note-about-context-objects">A note about context objects</a></h4>
<p>Options that accept Procs, lambdas, or method names are usually passed a <a href="#field-context">Field context</a> argument. It contains the object being rendered as well as other useful information.</p>
<h2 id="default-values"><a class="header" href="#default-values">Default Values</a></h2>
<p>These options allow you to set default values for fields and associations, and customize when they’re used.</p>
<h4 id="default"><a class="header" href="#default">default</a></h4>
<p>A default value used when the field or assocation is nil.</p>
<blockquote>
<p><em>Available in field, object, collection</em><br><strong>@param</strong> <a href="#field-context">Field context</a></p>
</blockquote>
<pre><code class="language-ruby">field :foo, default: "Foo"
field :foo, default: -&gt;(ctx) { "Foo" }
field :foo, default: :foo

def foo(ctx) = "Foo"
</code></pre>
<h4 id="field_default"><a class="header" href="#field_default">field_default</a></h4>
<p>Default value for any nil non-association field in its scope.</p>
<blockquote>
<p><em>Available in blueprint, view, partial, render</em><br><strong>@param</strong> <a href="#field-context">Field context</a></p>
</blockquote>
<pre><code class="language-ruby">options[:field_default] = "Foo"
options[:field_default] = -&gt;(ctx) { "Foo" }
options[:field_default] = :foo

def foo(ctx) = "Foo"

WidgetBluerpint.render(widget, field_default: "Foo").to_json
</code></pre>
<h4 id="object_default"><a class="header" href="#object_default">object_default</a></h4>
<p>Default value for any nil object field in its scope.</p>
<blockquote>
<p><em>Available in blueprint, view, partial, render</em><br><strong>@param</strong> <a href="#field-context">Field context</a></p>
</blockquote>
<pre><code class="language-ruby">options[:object_default] = { name: "Foo" }
options[:object_default] = -&gt;(ctx) { { name: "Foo" } }
options[:object_default] = :foo

def foo(ctx) = { name: "Foo" }

WidgetBluerpint.render(widget, object_default: { name: "Foo" }).to_json
</code></pre>
<h4 id="collection_default"><a class="header" href="#collection_default">collection_default</a></h4>
<p>Default value for any nil collection field.</p>
<blockquote>
<p><em>Available in blueprint, view, partial, render</em><br><strong>@param</strong> <a href="#field-context">Field context</a></p>
</blockquote>
<pre><code class="language-ruby">options[:collection_default] = [{ name: "Foo" }]
options[:collection_default] = -&gt;(ctx) { [{ name: "Foo" }] }
options[:collection_default] = :foo

def foo(ctx) = [{ name: "Foo" }]

WidgetBluerpint.render(widget, collection_default: [{ name: "Foo" }]).to_json
</code></pre>
<h4 id="default_if"><a class="header" href="#default_if">default_if</a></h4>
<p>Use the default value if the given Proc or method name returns truthy.</p>
<blockquote>
<p><em>Available in field, object, collection</em><br><strong>@param</strong> <a href="#field-context">Field context</a></p>
</blockquote>
<pre><code class="language-ruby">field :foo, default: "Foo", default_if: -&gt;(ctx) { ctx.object.disabled? }
field :foo, default: "Foo", default_if: :disabled?

def disabled?(ctx) = ctx.object.disabled?
</code></pre>
<h4 id="field_default_if"><a class="header" href="#field_default_if">field_default_if</a></h4>
<p>Same as <a href="#default_if">default_if</a>, but applies to any non-association field in scope.</p>
<blockquote>
<p><em>Available in blueprint, view, partial, render</em><br><strong>@param</strong> <a href="#field-context">Field context</a></p>
</blockquote>
<pre><code class="language-ruby">options[:field_default_if] = -&gt;(ctx) { ctx.object.disabled? }
options[:field_default_if] = :disabled?

def disabled?(ctx) = ctx.object.disabled?

WidgetBluerpint.render(widget, field_default_if: :disabled?).to_json
</code></pre>
<h4 id="object_default_if"><a class="header" href="#object_default_if">object_default_if</a></h4>
<p>Same as <a href="#default_if">default_if</a>, but applies to any object field in scope.</p>
<blockquote>
<p><em>Available in blueprint, view, partial, render</em><br><strong>@param</strong> <a href="#field-context">Field context</a></p>
</blockquote>
<pre><code class="language-ruby">options[:object_default_if] = -&gt;(ctx) { ctx.object.disabled? }
options[:object_default_if] = :disabled?

def disabled?(ctx) = ctx.object.disabled?

WidgetBluerpint.render(widget, object_default_if: :disabled?).to_json
</code></pre>
<h4 id="collection_default_if"><a class="header" href="#collection_default_if">collection_default_if</a></h4>
<p>Same as <a href="#default_if">default_if</a>, but applies to any collection field in scope.</p>
<blockquote>
<p><em>Available in blueprint, view, partial, render</em><br><strong>@param</strong> <a href="#field-context">Field context</a></p>
</blockquote>
<pre><code class="language-ruby">options[:collection_default_if] = -&gt;(ctx) { ctx.object.disabled? }
options[:collection_default_if] = :disabled?

def disabled?(ctx) = ctx.object.disabled?

WidgetBluerpint.render(widget, collection_default_if: :disabled?).to_json
</code></pre>
<h2 id="conditional-fields"><a class="header" href="#conditional-fields">Conditional Fields</a></h2>
<p>These options allow you to exclude fields from the output.</p>
<h4 id="exclude_if_nil"><a class="header" href="#exclude_if_nil">exclude_if_nil</a></h4>
<p>Exclude fields if they’re nil.</p>
<blockquote>
<p><em>Available in blueprint, view, partial, field, object, collection, render</em></p>
</blockquote>
<pre><code class="language-ruby">options[:exclude_if_nil] = true

field :description, exclude_if_nil: true

WidgetBluerpint.render(widget, exclude_if_nil: true).to_json
</code></pre>
<h4 id="exclude_if_empty"><a class="header" href="#exclude_if_empty">exclude_if_empty</a></h4>
<p>Exclude fields if they’re nil, or if they respond to <code>empty?</code> and it returns true.</p>
<blockquote>
<p><em>Available in blueprint, view, partial, field, object, collection, render</em></p>
</blockquote>
<pre><code class="language-ruby">options[:exclude_if_empty] = true

field :description, exclude_if_empty: true

WidgetBluerpint.render(widget, exclude_if_empty: true).to_json
</code></pre>
<h4 id="if"><a class="header" href="#if">if</a></h4>
<p>Only include the field if the given Proc or method name returns truthy.</p>
<blockquote>
<p><em>Available in field, object, collection</em><br><strong>@param</strong> <a href="#field-context">Field context</a></p>
</blockquote>
<pre><code class="language-ruby">field :foo, if: -&gt;(ctx) { ctx.object.enabled? }
field :foo, if: :enabled?

def enabled?(ctx) = ctx.object.enabled?
</code></pre>
<h4 id="field_if"><a class="header" href="#field_if">field_if</a></h4>
<p>Only include non-association fields if the given Proc or method name returns truthy.</p>
<blockquote>
<p><em>Available in blueprint, view, partial, render</em><br><strong>@param</strong> <a href="#field-context">Field context</a></p>
</blockquote>
<pre><code class="language-ruby">options[:field_if] = -&gt;(ctx) { ctx.object.enabled? }
options[:field_if] = :enabled?

def enabled?(ctx) = ctx.object.enabled?

WidgetBluerpint.render(widget, field_if: :enabled?).to_json
</code></pre>
<h4 id="object_if"><a class="header" href="#object_if">object_if</a></h4>
<p>Only include object fields if the given Proc or method name returns truthy.</p>
<blockquote>
<p><em>Available in blueprint, view, partial, render</em><br><strong>@param</strong> <a href="#field-context">Field context</a></p>
</blockquote>
<pre><code class="language-ruby">options[:object_if] = -&gt;(ctx) { ctx.object.enabled? }
options[:object_if] = :enabled?

def enabled?(ctx) = ctx.object.enabled?

WidgetBluerpint.render(widget, object_if: :enabled?).to_json
</code></pre>
<h4 id="collection_if"><a class="header" href="#collection_if">collection_if</a></h4>
<p>Only include collection fields if the given Proc or method name returns truthy.</p>
<blockquote>
<p><em>Available in blueprint, view, partial, render</em><br><strong>@param</strong> <a href="#field-context">Field context</a></p>
</blockquote>
<pre><code class="language-ruby">options[:collection_if] = -&gt;(ctx) { ctx.object.enabled? }
options[:collection_if] = :enabled?

def enabled?(ctx) = ctx.object.enabled?

WidgetBluerpint.render(widget, collection_if: :enabled?).to_json
</code></pre>
<h4 id="unless"><a class="header" href="#unless">unless</a></h4>
<p>Inverse of <a href="#if">if</a>.</p>
<h4 id="field_unless"><a class="header" href="#field_unless">field_unless</a></h4>
<p>Inverse of <a href="#field_if">field_if</a>.</p>
<h4 id="object_unless"><a class="header" href="#object_unless">object_unless</a></h4>
<p>Inverse of <a href="#object_if">object_if</a>.</p>
<h4 id="collection_unless"><a class="header" href="#collection_unless">collection_unless</a></h4>
<p>Inverse of <a href="#collection_if">collection_if</a>.</p>
<h2 id="field-mapping"><a class="header" href="#field-mapping">Field mapping</a></h2>
<p>These options let you change how fields values are extracted from your objects.</p>
<h4 id="from"><a class="header" href="#from">from</a></h4>
<p>Populate the field using a method/Hash key other than the field name.</p>
<blockquote>
<p><em>Available in field, object, collection</em></p>
</blockquote>
<pre><code class="language-ruby">field :desc, from: :description
</code></pre>
<h2 id="metadata"><a class="header" href="#metadata">Metadata</a></h2>
<p>These options allow you to add metadata to the rendered output.</p>
<h4 id="root"><a class="header" href="#root">root</a></h4>
<p>Pass a root key to wrap the output.</p>
<blockquote>
<p><em>Available in blueprint, view, partial, render</em></p>
</blockquote>
<pre><code class="language-ruby">options[:root] = :data

WidgetBlueprint.render(widget, root: :data).to_json
</code></pre>
<h4 id="meta"><a class="header" href="#meta">meta</a></h4>
<p>Add a <code>meta</code> key and data to the wrapped output (requires the <code>root</code> option).</p>
<blockquote>
<p><em>Available in blueprint, view, partial, render</em><br><strong>@param</strong> <a href="#result-context">Result context</a></p>
</blockquote>
<pre><code class="language-ruby">options[:root] = :data
options[:meta] = { page: 1 }

# If you pass a Proc/lambda, it can call instance methods defined on the Blueprint
options[:meta] = -&gt;(ctx) { { page: page_num(ctx) } }

WidgetBlueprint
  .render(widget, root: :data, meta: { page: params[:page] })
  .to_json
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="extensions"><a class="header" href="#extensions">Extensions</a></h1>
<p>Blueprinter has a powerful extension system that permits middleware throughout the entire serialization lifecycle. Some extensions are included with Blueprinter, others are available as gems, and you can easily write your own using the <a href="#extensions-2">Extension API</a>.</p>
<h2 id="using-extensions"><a class="header" href="#using-extensions">Using extensions</a></h2>
<p>Extensions can be added to your <code>ApplicationBlueprint</code> or any other blueprint, view, or partial. They’re inherited from parent classes and views, but can be overridden.</p>
<pre><code class="language-ruby">class MyBlueprint &lt; ApplicationBlueprint
  # This extension instance will exist for the duration of your program
  extensions &lt;&lt; FooExtension.new

  # These extensions will be initialized once during each render
  extensions &lt;&lt; BarExtension
  extensions &lt;&lt; -&gt; { ZorpExtension.new(some_args) }

  # Inline extensions are also initialized once per render
  extension do
    def around_blueprint(ctx)
      result = yield ctx
      result.merge({ foo: "Foo" })
    end
  end

  view :minimal do
    # extensions is a simple Array, so you can add or remove elements
    extensions.select! { |ext| ext.is_a? FooExtension }

    # or simply replace the whole Array
    self.extensions = [FooExtension.new]
  end
end
</code></pre>
<h2 id="included-extensions"><a class="header" href="#included-extensions">Included extensions</a></h2>
<p>These extensions are distributed with Blueprinter. Simply add them to your configuration.</p>
<h3 id="field-order"><a class="header" href="#field-order">Field Order</a></h3>
<p>Control the order of fields in your output. See <a href="#fields-3">Fields API</a> for more information about the block parameters.</p>
<pre><code class="language-ruby">extensions &lt;&lt; Blueprinter::Extensions::FieldOrder.new { |a, b| a.name &lt;=&gt; b.name }
</code></pre>
<h3 id="multijson"><a class="header" href="#multijson">MultiJson</a></h3>
<p>The MultiJson extension switches Blueprinter from Ruby’s built-in JSON library to the <a href="https://rubygems.org/gems/multi_json">multi_json</a> gem. Just install the <code>multi_json</code> gem, your serialization library of choice, and enable the extension.</p>
<pre><code class="language-ruby">extensions &lt;&lt; Blueprinter::Extensions::MultiJson.new

# Any options you pass will be forwarded to MultiJson.dump
extensions &lt;&lt; Blueprinter::Extensions::MultiJson.new(pretty: true)

# You can also pass MultiJson.dump options during render
WidgetBlueprint.render(widget, multi_json: { pretty: true }).to_json
</code></pre>
<p>If <code>multi_json</code> doesn’t support your preferred JSON library, you can use Blueprinter’s <a href="#around_result">around_result</a> extension hook to render JSON however you like.</p>
<h3 id="opentelemetry"><a class="header" href="#opentelemetry">OpenTelemetry</a></h3>
<p>Enable the OpenTelemetry extension to see what’s happening while you render your blueprints. One outer <code>blueprinter.render</code> span will nest various <code>blueprinter.object</code> and <code>blueprinter.collection</code> spans. Each span will include the blueprint/view name that triggered it.</p>
<p>Extension hooks will be wrapped in <code>blueprinter.extension</code> spans and annotated with the current extension and hook name.</p>
<pre><code class="language-ruby">extensions &lt;&lt; Blueprinter::Extensions::OpenTelemetry.new("my-tracer-name")
</code></pre>
<h3 id="viewoption"><a class="header" href="#viewoption">ViewOption</a></h3>
<p>The ViewOption extension uses the <a href="#around_result">around_result</a> extension hook to add a <code>view</code> option to <code>render</code>, <code>render_object</code>, and <code>render_collection</code>. It allows V1-compatible rendering of views.</p>
<pre><code class="language-ruby">extensions &lt;&lt; Blueprinter::Extensions::ViewOption.new
</code></pre>
<p>Now you can render a view either way:</p>
<pre><code class="language-ruby"># V2 style
MyBlueprint[:foo].render(obj)
# or V1 style
MyBlueprint.render(obj, view: :foo)
</code></pre>
<h2 id="gem-extensions"><a class="header" href="#gem-extensions">Gem extensions</a></h2>
<p><em>Have an extension you’d like to share? Let us know and we may add it to the list!</em></p>
<h3 id="blueprinter-activerecord"><a class="header" href="#blueprinter-activerecord">blueprinter-activerecord</a></h3>
<p><a href="https://github.com/procore-oss/blueprinter-activerecord">blueprinter-activerecord</a> is an official extension from the Blueprinter team providing ActiveRecord integration, including automatic preloading of associations based on your Blueprint definitions.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="rendering"><a class="header" href="#rendering">Rendering</a></h1>
<h3 id="rendering-to-json"><a class="header" href="#rendering-to-json">Rendering to JSON</a></h3>
<pre><code class="language-ruby">WidgetBlueprint.render(widget).to_json
</code></pre>
<p>If you’re using Rails, you may omit <code>.to_json</code> when calling <code>render json:</code></p>
<pre><code class="language-ruby">render json: WidgetBlueprint.render(widget)
</code></pre>
<p>Ruby’s built-in <code>JSON</code> library is used by default. Alternatively, you can use the built-in <a href="#multijson">MultiJson extension</a>. Or for total control, implement the <a href="#around_result">around_result</a> and call any serializer you like.</p>
<h3 id="rendering-to-a-hash"><a class="header" href="#rendering-to-a-hash">Rendering to a Hash</a></h3>
<pre><code class="language-ruby">WidgetBlueprint.render(widget).to_hash
</code></pre>
<h3 id="rendering-a-view"><a class="header" href="#rendering-a-view">Rendering a view</a></h3>
<pre><code class="language-ruby"># Render a view
WidgetBlueprint[:extended].render(widget).to_json

# Render a nested view
WidgetBlueprint["extended.price"].render(widget).to_json

# These two both render the default view
WidgetBlueprint.render(widget).to_json
WidgetBlueprint[:default].render(widget).to_json
</code></pre>
<h3 id="passing-options"><a class="header" href="#passing-options">Passing options</a></h3>
<p>An options hash can be passed to <code>render</code>. Read more about <a href="#options-1">options</a>.</p>
<pre><code class="language-ruby">WidgetBlueprint.render(Widget.all, exclude_if_nil: true).to_json
</code></pre>
<h3 id="rendering-collections"><a class="header" href="#rendering-collections">Rendering collections</a></h3>
<p><code>render</code> will treat any <code>Enumerable</code>, except <code>Hash</code>, as an array of objects:</p>
<pre><code class="language-ruby">WidgetBlueprint.render(Widget.all).to_json
</code></pre>
<p>If you wish to be explicit you may use <code>render_object</code> and <code>render_collection</code>:</p>
<pre><code class="language-ruby">WidgetBlueprint.render_object(widget).to_json

WidgetBlueprint.render_collection(Widget.all).to_json
</code></pre>
<p>Whatever you pass to <code>render_collection</code> must respond to <code>map</code>, yielding zero or more serializable objects, and returning an <code>Enumerable</code> with the mapped results.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="blueprinter-api"><a class="header" href="#blueprinter-api">Blueprinter API</a></h1>
<p>Blueprinter has a rich API for extending the serialization process and reflecting on your blueprints.</p>
<h2 id="extensions-1"><a class="header" href="#extensions-1">Extensions</a></h2>
<p>The extensions API offers middleware for various parts of the serialization process. <a href="#extensions-2">Read more</a>.</p>
<h2 id="reflection"><a class="header" href="#reflection">Reflection</a></h2>
<p>The reflection API allows your application, or Blueprinter extensions, to introspect on your blueprints’ options, fields, and views. <a href="#reflection-1">Read more</a>.</p>
<h2 id="context-objects"><a class="header" href="#context-objects">Context Objects</a></h2>
<p>Context objects are the arguments you’ll receive in most of the above APIs. <a href="#context-objects-1">Read more</a>.</p>
<h2 id="fields-1"><a class="header" href="#fields-1">Fields</a></h2>
<p>Several APIs provide access to structs describing field definitions. <a href="#fields-3">Read more</a>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="extensions-2"><a class="header" href="#extensions-2">Extensions</a></h1>
<p>Blueprinter has a powerful middleware-based extension system with hooks for every step of the serialization lifecycle. In fact, many of Blueprinter’s features are implemented using the extension API!</p>
<p>Simply extend the <code>Blueprinter::Extension</code> class, define the hooks you need, and <a href="#using-extensions">add it to your configuration</a>.</p>
<h2 id="hooks"><a class="header" href="#hooks">Hooks</a></h2>
<p>Hooks are called in the following order. They are passed a <a href="#context-objects-1">context object</a> as an argument.</p>
<div class="hooks"><a href="#around_result">around_result</a>
  <a href="#around_blueprint_init">around_blueprint_init</a>
    <a href="#around_serialize_object">around_serialize_object</a> | <a href="#around_serialize_collection">around_serialize_collection</a>
      <a href="#around_blueprint">around_blueprint</a>
        <a href="#around_field_value">around_field_value</a> | <a href="#around_object_value">around_object_value</a> | <a href="#around_collection_value">around_collection_value</a>
          <a href="#around_blueprint_init">around_blueprint_init...</a>
</div>

<p>Additionally, the <a href="#around_hook">around_hook</a> hook runs around all other hooks.</p>
<h3 id="around_result"><a class="header" href="#around_result">around_result</a></h3>
<blockquote>
<p><strong>param</strong> <a href="#result-context">Result Context</a> <br><strong>return</strong> result <br><strong>cost</strong> Low - run once during render</p>
</blockquote>
<p>The <code>around_result</code> hook runs around the entire serialization process, allowing you to modify the initial input and final output.</p>
<p>The following example hook caches an entire result for five minutes.</p>
<pre><code class="language-ruby">def around_result(ctx)
  cache(ctx.blueprint.class, ctx.object, ctx.format, ttl: 300) do
    yield ctx
  end
end
</code></pre>
<h4 id="finalizing"><a class="header" href="#finalizing">Finalizing</a></h4>
<p>The <code>final</code> and <code>final?</code> helpers allow middleware to declare, and check if, a result is “finalized” and should no longer be altered. These helpers should <strong>only</strong> be used in <code>around_result</code>.</p>
<pre><code class="language-ruby">def around_result(ctx)
  result = yield ctx
  return result if final? result

  result = somehow_modify result
  final result
end
</code></pre>
<h3 id="around_blueprint_init"><a class="header" href="#around_blueprint_init">around_blueprint_init</a></h3>
<blockquote>
<p><strong>param</strong> <a href="#render-context">Render Context</a> <br><strong>cost</strong> Low - run once per used blueprint during render</p>
</blockquote>
<p>The <code>around_blueprint_init</code> hook runs the first time a new Blueprint is used during a render cycle. It can be used by extensions to perform time-saving setup before a render.</p>
<blockquote class="blockquote-tag blockquote-tag-important">
<p class="blockquote-tag-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v9.5A1.75 1.75 0 0 1 14.25 13H8.06l-2.573 2.573A1.458 1.458 0 0 1 3 14.543V13H1.75A1.75 1.75 0 0 1 0 11.25Zm1.75-.25a.25.25 0 0 0-.25.25v9.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h6.5a.25.25 0 0 0 .25-.25v-9.5a.25.25 0 0 0-.25-.25Zm7 2.25v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 9a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>Important</p>
<p><code>around_blueprint_init</code> <strong>must</strong> yield, otherwise a <code>Blueprinter::Errors::ExtensionHook</code> will be raised.</p>
</blockquote>
<pre><code class="language-ruby">def around_blueprint_init(ctx)
  perform_setup ctx.blueprint, ctx.options
  yield ctx
end
</code></pre>
<h3 id="around_serialize_object"><a class="header" href="#around_serialize_object">around_serialize_object</a></h3>
<blockquote>
<p><strong>param</strong> <a href="#object-context">Object Context</a> <br><strong>return</strong> result <br><strong>cost</strong> Medium - run every time any blueprint is rendered</p>
</blockquote>
<p>The <code>around_serialize_object</code> hook runs around every object (as opposed to collection) that’s serialized. The following example would see it called <strong>four</strong> times: once for the category itself and once for each item.</p>
<pre><code class="language-ruby">CategoryBlueprint.render({
  name: "Foo",
  items: [item1, item2, item3],
}).to_json
</code></pre>
<p>The following example hook modifies both the input object and the output result.</p>
<pre><code class="language-ruby">def around_serialize_object(ctx)
  # modify the object before it's serialized
  ctx.object = modify ctx.object

  result = yield ctx

  # modify the result
  result.merge({ foo: "Bar" })
end
</code></pre>
<h3 id="around_serialize_collection"><a class="header" href="#around_serialize_collection">around_serialize_collection</a></h3>
<blockquote>
<p><strong>param</strong> <a href="#object-context">Object Context</a> <br><strong>return</strong> result <br><strong>cost</strong> Medium - run every time any blueprint is rendered</p>
</blockquote>
<p>The <code>around_serialize_collection</code> hook runs around every collection that’s serialized. The following example would see it called three times: once for the array of categories and once for each set of items.</p>
<pre><code class="language-ruby">CategoryBlueprint.render([
  { name: "Foo", items: [item1] },
  { name: "Bar", items: [item2, item3] },
]).to_json
</code></pre>
<p>The following example hook modifies both the input collection and the output results.</p>
<pre><code class="language-ruby">def around_serialize_collection(ctx)
  # modify the collection before it's serialized
  ctx.object = modify ctx.object

  result = yield ctx

  # modify the result
  result.reject { |obj| some_logic obj }
end
</code></pre>
<h3 id="around_blueprint"><a class="header" href="#around_blueprint">around_blueprint</a></h3>
<blockquote>
<p><strong>param</strong> <a href="#object-context">Object Context</a> <br><strong>return</strong> result <br><strong>cost</strong> Medium - run every time any blueprint is rendered</p>
</blockquote>
<p>The <code>around_blueprint</code> hook runs every time an object, including members of collections, are serialized. The following example would see it called three times: once for the category and once for each item.</p>
<pre><code class="language-ruby">CategoryBlueprint.render({ name: "Foo", items: [item1, item] }).to_json
</code></pre>
<p>The following example hook modifies both the input object and the output result.</p>
<pre><code class="language-ruby">def around_blueprint(ctx)
  # modify the object before it's serialized
  ctx.object = modify ctx.object

  result = yield ctx

  # modify the result
  result.merge({ foo: "Bar" })
end
</code></pre>
<h3 id="around_field_value"><a class="header" href="#around_field_value">around_field_value</a></h3>
<blockquote>
<p><strong>param</strong> <a href="#field-context">Field Context</a> <br><strong>return</strong> result <br><strong>cost</strong> High - run for every (non-object, non-collection) field</p>
</blockquote>
<p>The <code>around_field_value</code> hook runs around every non-object, non-collection field that’s extracted. The following example trims leading and trailing whitespace from string values.</p>
<pre><code class="language-ruby">def around_field_value(ctx)
  val = yield ctx
  case val
  when String then val.strip
  else val
  end
end
</code></pre>
<h4 id="skipping-fields"><a class="header" href="#skipping-fields">Skipping fields</a></h4>
<p>You can tell blueprinter to completely skip a field using <code>skip</code>. It will bail out of the hook and any previous hooks that yielded.</p>
<pre><code class="language-ruby">def around_field_value(ctx)
  val = yield ctx
  skip if ctx.field.options[:skip_on] == val
  val
end
</code></pre>
<h3 id="around_object_value"><a class="header" href="#around_object_value">around_object_value</a></h3>
<blockquote>
<p><strong>param</strong> <a href="#field-context">Field Context</a> <br><strong>return</strong> result <br><strong>cost</strong> High - run for every object field</p>
</blockquote>
<p>The <code>around_object_value</code> hook runs around every object field that’s extracted (before it’s serialized with a Blueprint). The following example adds a <code>foo</code> attribute to each object Hash.</p>
<pre><code class="language-ruby">def around_object_value(ctx)
  val = yield ctx
  case val
  when Hash then val.merge({ foo: "bar" })
  else val
  end
end
</code></pre>
<h4 id="skipping-fields-1"><a class="header" href="#skipping-fields-1">Skipping fields</a></h4>
<p>You can tell blueprinter to completely skip a field using <code>skip</code>. It will bail out of the hook and any previous hooks that yielded.</p>
<pre><code class="language-ruby">def around_object_value(ctx)
  val = yield ctx
  skip if ctx.field.options[:skip_on] == val
  val
end
</code></pre>
<h3 id="around_collection_value"><a class="header" href="#around_collection_value">around_collection_value</a></h3>
<blockquote>
<p><strong>param</strong> <a href="#field-context">Field Context</a> <br><strong>return</strong> result <br><strong>cost</strong> High - run for every collection field</p>
</blockquote>
<p>The <code>around_collection_value</code> hook runs around every collection field that’s extracted (before it’s serialized with a Blueprint). The following example removes deleted widgets from a collection.</p>
<pre><code class="language-ruby">def around_collection_value(ctx)
  val = yield ctx
  case ctx.field.blueprint
  when WidgetBlueprint
    val.reject { |widget| widget.deleted? }
  else
    val
  end
end
</code></pre>
<h4 id="skipping-fields-2"><a class="header" href="#skipping-fields-2">Skipping fields</a></h4>
<p>You can tell blueprinter to completely skip a field using <code>skip</code>. It will bail out of the hook and any previous hooks that yielded.</p>
<pre><code class="language-ruby">def around_collection_value(ctx)
  val = yield ctx
  skip if ctx.field.options[:skip_on] == val
  val
end
</code></pre>
<h3 id="around_hook"><a class="header" href="#around_hook">around_hook</a></h3>
<blockquote>
<p><strong>param</strong> <a href="#hook-context">Hook Context</a> <br><strong>cost</strong> Variable - runs around all your extensions</p>
</blockquote>
<p>The <code>around_hook</code> hook runs around all other extension hooks. Unlike other hooks, the return value <strong>not</strong> used.</p>
<blockquote class="blockquote-tag blockquote-tag-important">
<p class="blockquote-tag-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v9.5A1.75 1.75 0 0 1 14.25 13H8.06l-2.573 2.573A1.458 1.458 0 0 1 3 14.543V13H1.75A1.75 1.75 0 0 1 0 11.25Zm1.75-.25a.25.25 0 0 0-.25.25v9.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h6.5a.25.25 0 0 0 .25-.25v-9.5a.25.25 0 0 0-.25-.25Zm7 2.25v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 9a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>Important</p>
<p><code>around_hook</code> <strong>must</strong> yield, otherwise a <code>Blueprinter::Errors::ExtensionHook</code> will be raised.</p>
</blockquote>
<pre><code class="language-ruby">def around_hook(ctx)
  # do something
  yield
  # do something else
end
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="reflection-1"><a class="header" href="#reflection-1">Reflection</a></h1>
<p>Blueprints may be reflected on to inspect their views, fields, and options. This is useful for building <a href="#extensions-2">extensions</a>, and possibly even for some applications.</p>
<p>We will use the following blueprint in the examples below:</p>
<pre><code class="language-ruby">class WidgetBlueprint &lt; ApplicationBlueprint
  field :name
  field :description, exclude_if_empty: true
  object :category, CategoryBlueprint
  collection :parts, PartBlueprint

  view :extended do
    object :manufacturer, CompanyBlueprint[:full]

    view :with_price do
      field :price
    end
  end
end
</code></pre>
<h2 id="blueprint--view-names"><a class="header" href="#blueprint--view-names">Blueprint &amp; view names</a></h2>
<pre><code class="language-ruby">WidgetBlueprint.blueprint_name
=&gt; "WidgetBlueprint"

WidgetBlueprint.view_name
=&gt; :default

WidgetBlueprint[:extended].blueprint_name
=&gt; "WidgetBlueprint.extended"

WidgetBlueprint[:extended].view_name
=&gt; :extended

WidgetBlueprint["extended.with_price"].blueprint_name
=&gt; "WidgetBlueprint.extended.with_price"

WidgetBlueprint["extended.with_price"].view_name
=&gt; :"extended.with_price"
</code></pre>
<h2 id="blueprint--view-options"><a class="header" href="#blueprint--view-options">Blueprint &amp; view options</a></h2>
<pre><code class="language-ruby">WidgetBlueprint.options
=&gt; {exclude_if_nil: true}

WidgetBlueprint[:extended].options
=&gt; {exclude_if_nil: true, exclude_if_empty: true}
</code></pre>
<h2 id="views-1"><a class="header" href="#views-1">Views</a></h2>
<p>Here, <code>:default</code> refers to the top level of the blueprint.</p>
<pre><code class="language-ruby">WidgetBlueprint.reflections.keys
=&gt; [:default, :extended, :"extended.with_price"]
</code></pre>
<p>You can also reflect directly on a view.</p>
<pre><code class="language-ruby">WidgetBlueprint[:extended].reflections.keys
=&gt; [:default, :with_price]
</code></pre>
<p><strong>Notice that the names are relative</strong>: <code>:default</code> now refers to the <code>:extended</code> view, since we called <code>.reflections</code> on <code>:extended</code>. The prefix is also gone from the nested <code>:with_price</code> view.</p>
<h2 id="fields-2"><a class="header" href="#fields-2">Fields</a></h2>
<pre><code class="language-ruby">view = WidgetBlueprint.reflections[:default]

# Regular fields
view.fields.keys
=&gt; [:name, :description]

# Object fields
view.objects.keys
=&gt; [:category]

# Collection fields
view.collections.keys
=&gt; [:parts]

# All fields in the order they were defined
view.ordered
# returns an array of field objects
</code></pre>
<h2 id="field-metadata"><a class="header" href="#field-metadata">Field metadata</a></h2>
<pre><code class="language-ruby">view = WidgetBlueprint.reflections[:default]
field = view.fields[:description]

field.name
=&gt; :description

field.from
=&gt; :description # the :from option in the DSL

field.value_proc
=&gt; nil # the block you passed to the field, if any

field.options # all other options passed to the field
=&gt; { exclude_if_empty: true }
</code></pre>
<p>Object and collection fields have the same metadata as regular fields, plus a <code>blueprint</code> attribute:</p>
<pre><code class="language-ruby">view = WidgetBlueprint.reflections[:default]
field = view.collections[:parts]

# it returns the Blueprint class, so you can continue reflecting
field.blueprint
=&gt; PartBlueprint

field.blueprint.reflections[:default].fields
=&gt; # array of fields on the default view of PartBlueprint
</code></pre>
<p>If you used a view in an object or collection field, you can reflect on that view just like a blueprint:</p>
<pre><code class="language-ruby">view = WidgetBlueprint.reflections[:extended]
field = view.objects[:manufacturer]

field.blueprint.to_s
=&gt; "CompanyBlueprint.full"

# Remember, we're reflecting ON the :full view, so the name is relative!
field.blueprint.reflections[:default].fields
=&gt; # array of fields on the :full view of CompanyBlueprint
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="context-objects-1"><a class="header" href="#context-objects-1">Context Objects</a></h1>
<p>Context objects are the arguments passed to APIs like <a href="#field-blocks">field blocks</a>, <a href="#options-1">option procs</a> and <a href="#extensions-2">extension hooks</a>. There are several kinds of context objects, each with its own set of fields.</p>
<h2 id="render-context"><a class="header" href="#render-context">Render Context</a></h2>
<p><em>* Field can be assigned.</em></p>
<blockquote>
<p><strong>blueprint</strong> <br>The current Blueprint instance. You can use this to access the Blueprint’s name, options, reflections, and instance methods.</p>
</blockquote>
<blockquote>
<p><strong>fields</strong> * <br>A frozen array of field definitions that will be serialized, in order. See <a href="#fields-3">Fields API</a>.</p>
</blockquote>
<blockquote>
<p><strong>options</strong> * <br>The frozen options Hash passed to <code>render</code>. An empty Hash if none was passed.</p>
</blockquote>
<blockquote>
<p><strong>store</strong> <br>A Hash that can be used to store &amp; access information by extensions and your application.</p>
</blockquote>
<blockquote>
<p><strong>depth</strong> <br>The current blueprint depth (1-indexed).</p>
</blockquote>
<h2 id="object-context"><a class="header" href="#object-context">Object Context</a></h2>
<p><em>* Field can be assigned.</em></p>
<blockquote>
<p><strong>blueprint</strong> <br>The current Blueprint instance. You can use this to access the Blueprint’s name, options, reflections, and instance methods.</p>
</blockquote>
<blockquote>
<p><strong>fields</strong> <br>A frozen array of field definitions that will be serialized, in order. See <a href="#fields-3">Fields API</a> and the <a href="#blueprint_fields">blueprint_fields</a> hook.</p>
</blockquote>
<blockquote>
<p><strong>options</strong> <br>The frozen options Hash passed to <code>render</code>. An empty Hash if none was passed.</p>
</blockquote>
<blockquote>
<p><strong>object</strong> * <br>The object or collection currently being serialized.</p>
</blockquote>
<blockquote>
<p><strong>store</strong> <br>A Hash that can be used to store &amp; access information by extensions and your application.</p>
</blockquote>
<blockquote>
<p><strong>depth</strong> <br>The current blueprint depth (1-indexed).</p>
</blockquote>
<h2 id="field-context"><a class="header" href="#field-context">Field Context</a></h2>
<blockquote>
<p><strong>blueprint</strong> <br>The current Blueprint instance. You can use this to access the Blueprint’s name, options, reflections, and instance methods.</p>
</blockquote>
<blockquote>
<p><strong>fields</strong> <br>A frozen array of field definitions that will be serialized, in order. See <a href="#fields-3">Fields API</a> and the <a href="#blueprint_fields">blueprint_fields</a> hook.</p>
</blockquote>
<blockquote>
<p><strong>options</strong> <br>The frozen options Hash passed to <code>render</code>. An empty Hash if none was passed.</p>
</blockquote>
<blockquote>
<p><strong>object</strong> <br>The object currently being serialized.</p>
</blockquote>
<blockquote>
<p><strong>field</strong> <br>A struct of the field, object, or collection currently being rendered. You can use this to access the field’s name and options. See <a href="#fields-3">Fields API</a>.</p>
</blockquote>
<blockquote>
<p><strong>store</strong> <br>A Hash that can be used to store &amp; access information by extensions and your application.</p>
</blockquote>
<blockquote>
<p><strong>depth</strong> <br>The current blueprint depth (1-indexed).</p>
</blockquote>
<h2 id="result-context"><a class="header" href="#result-context">Result Context</a></h2>
<p><em>* Field can be assigned.</em></p>
<blockquote>
<p><strong>blueprint</strong> * <br>The current Blueprint instance. You can use this to access the Blueprint’s name, options, reflections, and instance methods.</p>
</blockquote>
<blockquote>
<p><strong>fields</strong> <br>A frozen array of field definitions that were serialized, in order. See <a href="#fields-3">Fields API</a> and the <a href="#around_blueprint_init">around_blueprint_init</a> hook.</p>
</blockquote>
<blockquote>
<p><strong>options</strong> * <br>The frozen options Hash passed to <code>render</code>. An empty Hash if none was passed.</p>
</blockquote>
<blockquote>
<p><strong>object</strong> * <br>The object or collection that was just serialized.</p>
</blockquote>
<blockquote>
<p><strong>store</strong> <br>A Hash that can be used to store &amp; access information by extensions and your application.</p>
</blockquote>
<blockquote>
<p><strong>format</strong> * <br>The requested serialization format (e.g. <code>:json</code>, <code>:hash</code>).</p>
</blockquote>
<h2 id="hook-context"><a class="header" href="#hook-context">Hook Context</a></h2>
<blockquote>
<p><strong>blueprint</strong> <br>The current Blueprint instance. You can use this to access the Blueprint’s name, options, reflections, and instance methods.</p>
</blockquote>
<blockquote>
<p><strong>fields</strong> <br>A frozen array of field definitions that will be serialized, in order. See <a href="#fields-3">Fields API</a> and the <a href="#around_blueprint_init">around_blueprint_init</a> hook.</p>
</blockquote>
<blockquote>
<p><strong>options</strong> <br>The frozen options Hash passed to <code>render</code>. An empty Hash if none was passed.</p>
</blockquote>
<blockquote>
<p><strong>extension</strong> <br>Instance of the current extension</p>
</blockquote>
<blockquote>
<p><strong>hook</strong> <br>Name of the current hook</p>
</blockquote>
<blockquote>
<p><strong>store</strong> <br>A Hash that can be used to store &amp; access information by extensions and your application.</p>
</blockquote>
<blockquote>
<p><strong>depth</strong> <br>The current blueprint depth (1-indexed).</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="fields-3"><a class="header" href="#fields-3">Fields</a></h1>
<p>Extensions, reflection, and other APIs allow access to structs that describe fields.</p>
<blockquote>
<p><strong>type</strong><br><em>Symbol</em> <code>:field | :object | :collection</code><br>The type of field.</p>
</blockquote>
<blockquote>
<p><strong>name</strong><br><em>Symbol</em><br>Name of the field as it will appear in the JSON or Hash output.</p>
</blockquote>
<blockquote>
<p><strong>from</strong><br><em>Symbol</em><br>Name of the field in the source object (usually the same as <code>name</code>).</p>
</blockquote>
<blockquote>
<p><strong>from_str</strong><br><em>String</em><br>Same as <code>from</code>, but as a frozen string.</p>
</blockquote>
<blockquote>
<p><strong>value_proc</strong><br><em>nil | Proc</em><br>The block passed to the field definition (if given). Expects a <a href="#field-context">Field Context</a> argument and returns the field value.</p>
</blockquote>
<blockquote>
<p><strong>options</strong><br><em>Hash</em><br>A frozen Hash of any additional options passed to the field.</p>
</blockquote>
<blockquote>
<p><strong>blueprint</strong> (object and collection only)<br><em>Class</em><br>The blueprint to use for serializaing the object or collection.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="upgrading-to-api-v2"><a class="header" href="#upgrading-to-api-v2">Upgrading to API V2</a></h1>
<p>You have two options when updating from the legacy/V1 API: <a href="#full-update">full update</a> or <a href="#incremental-update">incremental update</a>.</p>
<p>Regardless which you choose, you’ll need to familiarize yourself with the <a href="#blueprinter-dsl">new DSL</a> and <a href="#blueprinter-api">API</a>. The rest of this section will focus on the differences between V1 and V2.</p>
<h2 id="full-update"><a class="header" href="#full-update">Full update</a></h2>
<p>Update <code>blueprinter</code> to 2.x. All of your blueprints will need updated to use the <a href="#blueprinter-dsl">new DSL</a>. If you’re making use of extensions, custom extractors, or transformers, they’ll also need updated to the <a href="#blueprinter-api">new API</a>.</p>
<h2 id="incremental-update"><a class="header" href="#incremental-update">Incremental update</a></h2>
<p>Larger applications may find it easier to update incrementally. Update <code>blueprinter</code> to 1.2.x, which contains both the legacy/V1 and V2 APIs. They can be used side-by-side.</p>
<pre><code class="language-ruby"># A legacy/V1 blueprint
class WidgetBlueprint &lt; Blueprinter::Blueprint
  field :name

  view :with_desc do
    field :description
  end

  view :with_category do
    # Using a V2 blueprint in a legacy/V1 blueprint
    association :category, blueprint: CategoryBlueprint, view: :extended
  end
end

# A V2 blueprint
class CategoryBlueprint &lt; ApplicationBlueprint
  field :name

  view :extended do
    # Using a legacy/V1 blueprint in a V2 blueprint
    collection :widgets, WidgetBlueprint[:with_desc]
  end
end
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="configuration"><a class="header" href="#configuration">Configuration</a></h1>
<p>Blueprinter V2 has no concept of global configruation like V1’s <code>Blueprinter.configure</code>. Instead, blueprints and views inherit configuration from their parent classes. By putting your “global” configuration into <code>ApplicationBlueprint</code>, all your application’s blueprints and views will inherit it.</p>
<pre><code class="language-ruby">class ApplicationBlueprint &lt; Blueprinter::Blueprint
  options[:exclude_if_nil] = true
  extensions &lt;&lt; MyExtension.new
end
</code></pre>
<p>Read more about <a href="#options-1">options</a> and <a href="#extensions">extensions</a>.</p>
<h2 id="overrides"><a class="header" href="#overrides">Overrides</a></h2>
<p>Child classes, <a href="#views">views</a>, and <a href="#partials">partials</a> can override their inherited configuration.</p>
<pre><code class="language-ruby">class MyBlueprint &lt; ApplicationBlueprint
  options[:exclude_if_nil] = false

  view :foo do
    options.clear
    extensions.clear
  end
end
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="customization"><a class="header" href="#customization">Customization</a></h1>
<h2 id="formatting"><a class="header" href="#formatting">Formatting</a></h2>
<p>Blueprinter V2 has a more generic approach to formatting, allowing any type of value to have formatting applied. <a href="#formatters">Learn more</a>.</p>
<pre><code class="language-ruby">format(Date) { |date| date.iso8601 }
</code></pre>
<p>The <a href="#around_field_value">around_field_value</a>, <a href="#around_object_value">around_object_value</a>, and <a href="#around_collection_value">around_collection_value</a> extension hooks can also be used.</p>
<h2 id="custom-extractors"><a class="header" href="#custom-extractors">Custom extractors</a></h2>
<p>Custom extraction in V2 can also be accomplished with the <a href="#around_field_value">around_field_value</a>, <a href="#around_object_value">around_object_value</a>, and <a href="#around_collection_value">around_collection_value</a> hooks. <a href="#extracting-with-extensions">Read more</a>.</p>
<h2 id="transformers"><a class="header" href="#transformers">Transformers</a></h2>
<p>Blueprinter V2’s <a href="#extensions-2">extension hooks</a> offer many ways to transform your inputs and outputs. The <a href="#around_blueprint">around_blueprint</a> hook offers equivalent functionality to Legacy/V1 transformers.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="fields-4"><a class="header" href="#fields-4">Fields</a></h1>
<h2 id="identifier-field-and-view"><a class="header" href="#identifier-field-and-view">Identifier field and view</a></h2>
<p>Blueprinter Legacy/V1 had a special feature for an <code>id</code> field and <code>identifier</code> view. Blueprinter V2 does not have this concept, but you can simulate it in your <code>ApplicationBlueprint</code>.</p>
<pre><code class="language-ruby">class ApplicationBlueprint &lt; Blueprinter::Blueprint
  # Every Blueprint that inherits from ApplicationBlueprint will have this field
  field :id

  # Every Blueprint that inherits from ApplicationBlueprint will have this view,
  # and it will only have the `id` field
  view :identifier, empty: true do
    field :id
  end
end
</code></pre>
<h2 id="renaming-fields"><a class="header" href="#renaming-fields">Renaming fields</a></h2>
<p>In Blueprinter Legacy/V1, you could rename fields using the <code>name</code> option. Blueprinter V2 swaps the order and uses <code>from</code>. We believe this makes your blueprints more readable.</p>
<p>In the following examples, both blueprints are populating the output field <em>description</em> from a source attribute named <em>desc</em>.</p>
<pre><code class="language-ruby"># Legacy/V1
field :desc, name: :description

# V2
field :description, from: :desc
</code></pre>
<h2 id="associations"><a class="header" href="#associations">Associations</a></h2>
<p>Blueprinter Legacy/V1 figured out if associations were single items or arrays at runtime. Blueprinter V2 accounts for this in the DSL. Also, the <code>:blueprint</code> and <code>:view</code> options are gone.</p>
<pre><code class="language-ruby">class WidgetBlueprint &lt; ApplicationBlueprint
  field :name
  object :category, CategoryBlueprint
  collection :parts, PartBlueprint

  # specify a view
  object :manufacturer, CompanyBlueprint[:extended]
end
</code></pre>
<h2 id="field-order-1"><a class="header" href="#field-order-1">Field order</a></h2>
<p>Blueprinter Legacy/V1 offered two options for ordering fields: <code>:name_asc</code> (default), and <code>:definition</code> (order they were defined in). Blueprinter V2 defaults to the order of definition. You can define a different order using the <a href="#around_blueprint_init">around_blueprint_init</a> extension hook or the built-in <a href="#field-order">FieldOrder</a> extension.</p>
<p>The following replicates Legacy/V1’s default field order using the built-in <a href="#field-order">FieldOrder</a> extension.</p>
<pre><code class="language-ruby">class ApplicationBlueprint &lt; Blueprinter::Blueprint
  extensions &lt;&lt; Blueprinter::Extensions::FieldOrder.new do |a, b|
    if a.name == :id
      -1
    elsif b.name == :id
      1
    else
      a.name &lt;=&gt; b.name
    end
  end
end
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="rendering-1"><a class="header" href="#rendering-1">Rendering</a></h1>
<p>You can read the full <a href="#rendering">rendering documentation here</a>. This page highlights the main differences between V1 and V2.</p>
<h3 id="rendering-to-json-1"><a class="header" href="#rendering-to-json-1">Rendering to JSON</a></h3>
<p>If you’re using Rails’s <code>render json:</code>, V2 blueprints should continue to work like Legacy/V1:</p>
<pre><code class="language-ruby">render json: WidgetBlueprint.render(widget)
</code></pre>
<p>Otherwise, it now looks like this:</p>
<pre><code class="language-ruby">WidgetBlueprint.render(widget).to_json
</code></pre>
<h3 id="rendering-to-hash"><a class="header" href="#rendering-to-hash">Rendering to Hash</a></h3>
<pre><code class="language-ruby">WidgetBlueprint.render(widget).to_hash
</code></pre>
<h3 id="views-2"><a class="header" href="#views-2">Views</a></h3>
<p>V2’s preferred method of rendering views is:</p>
<pre><code class="language-ruby">WidgetBlueprint[:extended].render(widget).to_json
</code></pre>
<p>However, the <a href="#viewoption">ViewOption</a> extension can be enabled to allow V1-style view rendering:</p>
<pre><code class="language-ruby">WidgetBlueprint.render(widget, view: :extended).to_json
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="reflection-2"><a class="header" href="#reflection-2">Reflection</a></h1>
<p>The <a href="#reflection-1">V2 Reflection API</a> has very few changes from Legacy/V1.</p>
<h2 id="reflecting-on-fields"><a class="header" href="#reflecting-on-fields">Reflecting on fields</a></h2>
<p>Regular fields (no change):</p>
<pre><code class="language-ruby">MyBlueprint.reflections[:default].fields
</code></pre>
<p>Objects and collections:</p>
<pre><code class="language-ruby"># Legacy/V1 does not differentiate between objects and collections
MyV1Blueprint.reflections[:default].associations

# V2 does
MyV2Blueprint.reflections[:default].objects
MyV2Blueprint.reflections[:default].collections
</code></pre>
<h2 id="field-names"><a class="header" href="#field-names">Field names</a></h2>
<p><a href="#field-metadata">V2’s field metadata</a> is similar, but there’s an important different in <code>name</code>.</p>
<h4 id="legacyv1"><a class="header" href="#legacyv1">Legacy/V1</a></h4>
<p>In Legacy/V1, <code>name</code> refers to what the field is called in the <em>input</em>.</p>
<pre><code class="language-ruby">class MyV1Blueprint &lt; Blueprinter::Base
  field :foo, name: :bar
end

ref = MyV1Blueprint.reflections[:default]

# What the field is called in the source object
ref.fields[:foo].name
=&gt; :foo

# What the field will be called in the output
ref.fields[:foo].display_name
=&gt; :bar
</code></pre>
<h4 id="v2"><a class="header" href="#v2">V2</a></h4>
<p>In V2, <code>name</code> refers to what the field is called in the <em>output</em>. Note that this change is also reflected in the Hash key.</p>
<pre><code class="language-ruby">class MyV2Blueprint &lt; Blueprinter::Blueprint
  field :bar, from: :foo
end

ref = MyV1Blueprint.reflections[:default]

# What the field will be called in the output
ref.fields[:bar].name
=&gt; :bar

# What the field is called in the source object
ref.fields[:bar].from
=&gt; :foo
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="extensions-3"><a class="header" href="#extensions-3">Extensions</a></h1>
<p>The <a href="#extensions-2">V2 Extension API</a>, as well as the DSL for <a href="#extensions">enabling V2 extensions</a>, are vastly different and more powerful than V1. Legacy/V1 had only one extension hook: <code>pre_render</code>. V2 <a href="#hooks">has eight</a>.</p>
<h2 id="porting-pre_render"><a class="header" href="#porting-pre_render">Porting pre_render</a></h2>
<p>Legacy/V1’s <code>pre_render</code> hook does not exist in V2, but it has several possible replacements:</p>
<ul>
<li><a href="#around_result">around_result</a> runs once around each entire result</li>
<li><a href="#around_serialize_object">around_serialize_object</a> runs around each object’s serialization</li>
<li><a href="#around_serialize_collection">around_serialize_collection</a> runs around each collection’s serialization</li>
<li><a href="#around_blueprint">around_blueprint</a> runs each time a blueprint serializes an object</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="legacyv1-docs"><a class="header" href="#legacyv1-docs">Legacy/V1 Docs</a></h1>
<p>TODO copy from old README</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr-ef4e11c1.min.js"></script>
        <script src="mark-09e88c2c.min.js"></script>
        <script src="searcher-c2a407aa.js"></script>

        <script src="clipboard-1626706a.min.js"></script>
        <script src="highlight-cacfe08c.js"></script>
        <script src="book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>


    </div>
    </body>
</html>
